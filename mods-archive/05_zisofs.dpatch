#! /bin/sh -e
## 05.dpatch by Joerg Jaspert <joerg@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Adds the zisofs_tools to the build tree.
## DP: The zisofs filesystem is an extension to the ISO9660 filesystem
## DP: that allows files, on a file-by-file basis, to be stored compressed
## DP: and decompressed in real time. The zisofs filesystem is supported by
## DP: recent versions of Linux (2.4.14 or later). Legacy systems can still
## DP: read uncompressed files. zisofs-tools contains the tools necessary to
## DP: create such a compressed ISO9660 filesystem and to read compressed
## DP: files on a legacy system.

if [ $# -ne 1 ]; then
    echo >&2 "`basename $0`: script expects -patch|-unpatch as argument"
    exit 1
fi
case "$1" in
	-patch) patch -f --no-backup-if-mismatch -p0 < $0;;
	-unpatch) patch -f --no-backup-if-mismatch -R -p0 < $0;;
	*)
		echo >&2 "`basename $0`: script expects -patch|-unpatch as argument"
		exit 1;;
esac

exit 0
				    

@DPATCH@
--- TARGETS/55zisofs_tools	1970-01-01 01:00:00.000000000 +0100
+++ TARGETS/55zisofs_tools	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1 @@
+Tools for preparing compressed filesystems

--- zisofs_tools/aclocal.m4	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/aclocal.m4	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,35 @@
+dnl --------------------------------------------------------------------------
+dnl PA_ADD_CFLAGS()
+dnl
+dnl Attempt to add the given option to CFLAGS, if it doesn't break compilation
+dnl --------------------------------------------------------------------------
+AC_DEFUN(PA_ADD_CFLAGS,
+[AC_MSG_CHECKING([if $CC accepts $1])
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS $1"
+ AC_TRY_COMPILE([#include <stdio.h>],
+ [printf("Hello, World!\n");],
+ AC_MSG_RESULT([yes]),
+ AC_MSG_RESULT([no])
+ CFLAGS="$pa_add_cflags__old_cflags")])
+
+dnl ------------------------------------------------------------------------
+dnl  PA_WITH_BOOL
+dnl
+dnl  PA_WITH_BOOL(option, default, help, enable, disable)
+dnl
+dnl  Provides a more convenient way to specify --with-option and
+dnl  --without-option, with a default.  default should be either 0 or 1.
+dnl ------------------------------------------------------------------------
+AC_DEFUN(PA_WITH_BOOL,
+[AC_ARG_WITH([$1], [$3],
+if test ["$withval"] != no; then
+[$4]
+else
+[$5]
+fi,
+if test [$2] -ne 0; then
+[$4]
+else
+[$5]
+fi)])

--- zisofs_tools/CHANGES	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/CHANGES	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,49 @@
+Changes in zisofs-tools-1.0.4:
+
+	Update the documentation.
+
+Changes in zisofs-tools-1.0.3:
+
+	Update cdrtools patch.
+
+Changes in zisofs-tools-1.0.2:
+
+	Add "make install" target :)
+
+Changes in zisofs-tools-1.0.1:
+
+	By default, abort if file modes, times and ownership cannot be
+	set.  Since this isn't always possible, add new option
+	-s/--sloppy to suppress this error.
+
+	Fix man page typo, and add a BUGS section.
+
+	Remove problems with extremely long symlinks.
+
+	Move all command line options into common "opt" structure.
+
+	Fix bug in command line parsing: -z option not recognized.
+
+
+Changes in zisofs-tools-1.0:
+
+	Restructured code; now split into a number of modules.
+
+	Use autoconf for configuration.
+
+	Add support for long options if the platform has
+	getopt_long().
+
+	Support compiling on systems without lchown().
+
+	Support the following new options:
+	  -x	Don't descend into other filesystems
+	  -X	Same as -x, but don't create mount point directories
+	  -l	Don't descend into any subdirectories
+	  -L	Same as -l, but don't create stub directories
+	  -F	Allow compression or decompression of single files.
+	  -V	Explicitly set the verbosity.
+	  -w	Display program version.
+
+	  Update the mkisofs patch to warn if -z is specified without
+	  -r/-R.

--- zisofs_tools/compress.c	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/compress.c	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,141 @@
+/* $Id: compress.c,v 1.3 2001/07/31 03:20:52 hpa Exp $ */
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <utime.h>
+#include <unistd.h>
+#include <zlib.h>
+#include "mkzftree.h"
+#include "iso9660.h"
+
+
+int block_compress_file(FILE *input, FILE *output, off_t size)
+{
+  struct compressed_file_header hdr;
+  char inbuf[CBLOCK_SIZE], outbuf[2*CBLOCK_SIZE];
+  size_t bytes, pointer_bytes, nblocks, block;
+  uLong cbytes;			/* uLong is a zlib datatype */
+  char *pointer_block, *curptr;
+  off_t position;
+  int i;
+  int force_compress = opt.force;
+  int zerr;
+  int err = EX_SOFTWARE;
+  
+  if ( (sizeof hdr) & 3 ) {
+    fputs("INTERNAL ERROR: header is not a multiple of 4\n", stderr);
+    abort();
+  }
+
+  memset(&hdr, 0, sizeof hdr);
+  memcpy(&hdr.magic, zisofs_magic, sizeof zisofs_magic);
+  hdr.header_size = (sizeof hdr) >> 2;
+  hdr.block_size = CBLOCK_SIZE_LG2;
+  set_731(&hdr.uncompressed_len, size);
+
+  if ( fwrite(&hdr, sizeof hdr, 1, output) != 1 )
+    return EX_CANTCREAT;
+
+  nblocks = (size+CBLOCK_SIZE-1) >> CBLOCK_SIZE_LG2;
+  pointer_bytes = 4*(nblocks+1);
+  pointer_block = xmalloc(pointer_bytes);
+  memset(pointer_block, 0, pointer_bytes);
+
+  if ( fseek(output, pointer_bytes, SEEK_CUR) == -1 ) {
+    err = EX_CANTCREAT;
+    goto free_ptr_bail;
+  }
+
+  curptr = pointer_block;
+  position = sizeof hdr + pointer_bytes;
+  
+  block = 0;
+  while ( (bytes = fread(inbuf, 1, CBLOCK_SIZE, input)) > 0 ) {
+    if ( bytes < CBLOCK_SIZE && block < nblocks-1 ) {
+      err = EX_IOERR;
+      goto free_ptr_bail;
+    }
+
+    /* HACK: If the file has our magic number, always compress */
+    if ( block == 0 && bytes >= sizeof zisofs_magic ) {
+      if ( !memcmp(inbuf, zisofs_magic, sizeof zisofs_magic) )
+	force_compress = 1;
+    }
+
+    set_731(curptr, position); curptr += 4;
+    
+    /* We have two special cases: a zero-length block is defined as all zero,
+       and a block the length of which is equal to the block size is unencoded. */
+
+    for ( i = 0 ; i < (int)CBLOCK_SIZE ; i++ ) {
+      if ( inbuf[i] ) break;
+    }
+
+    if ( i == CBLOCK_SIZE ) {
+      /* All-zero block.  No output */
+    } else {
+      cbytes = 2*CBLOCK_SIZE;
+      if ( (zerr = compress2(outbuf, &cbytes, inbuf, bytes, opt.level))
+	   != Z_OK ) {
+	err = (zerr == Z_MEM_ERROR) ? EX_OSERR : EX_SOFTWARE;
+	goto free_ptr_bail;	/* Compression failure */
+      }
+      if ( fwrite(outbuf, 1, cbytes, output) != cbytes ) {
+	err = EX_CANTCREAT;
+	goto free_ptr_bail;
+      }
+      position += cbytes;
+    }
+    block++;
+  }
+
+  /* Set pointer to the end of the final block */
+  set_731(curptr, position);
+
+  /* Now write the pointer table */
+  if ( fseek(output, sizeof hdr, SEEK_SET) == -1 ||
+       fwrite(pointer_block, 1, pointer_bytes, output) != pointer_bytes ) {
+    err = EX_CANTCREAT;
+    goto free_ptr_bail;
+  }
+
+  free(pointer_block);
+
+  /* Now make sure that this was actually the right thing to do */
+  if ( !force_compress && position >= size ) {
+    /* Incompressible file, just copy it */
+    rewind(input);
+    rewind(output);
+
+    position = 0;
+    while ( (bytes = fread(inbuf, 1, CBLOCK_SIZE, input)) > 0 ) {
+      if ( fwrite(inbuf, 1, bytes, output) != bytes )
+	return EX_CANTCREAT;
+      position += bytes;
+    }
+
+    /* Truncate the file to the correct size */
+    fflush(output);
+    ftruncate(fileno(output), position);
+  }
+
+  /* If we get here, we're done! */
+  return 0;
+
+  /* Common bailout code */
+ free_ptr_bail:
+  free(pointer_block);
+  return err;
+}
+

--- zisofs_tools/config.h	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/config.h	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,28 @@
+/* config.h.  Generated automatically by configure.  */
+/* -*- c -*- ------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+/* $Id: config.h.in,v 1.1 2001/07/27 14:37:07 hpa Exp $ */
+
+/*
+ * config.h.in
+ *
+ * Pattern file for configurations
+ */
+
+#define HAVE_SYSEXITS_H 1		/* Define if <sysexits.h> exists */
+#define HAVE_GETOPT_H 1		/* Define if <getopt.h> exists */
+#define HAVE_GETOPT_LONG 1		/* Define if we have getopt_long() */
+#define HAVE_LCHOWN 1		/* Define if we have lchown() */
+/* #undef off_t */			/* Define to long if off_t missing */
+/* #undef size_t */			/* Define to unsigned long if size_t missing */
+/* #undef ssize_t */			/* Define to long if ssize_t missing */
+

--- zisofs_tools/config.h.in	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/config.h.in	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,27 @@
+/* -*- c -*- ------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+/* $Id: config.h.in,v 1.1 2001/07/27 14:37:07 hpa Exp $ */
+
+/*
+ * config.h.in
+ *
+ * Pattern file for configurations
+ */
+
+#undef HAVE_SYSEXITS_H		/* Define if <sysexits.h> exists */
+#undef HAVE_GETOPT_H		/* Define if <getopt.h> exists */
+#undef HAVE_GETOPT_LONG		/* Define if we have getopt_long() */
+#undef HAVE_LCHOWN		/* Define if we have lchown() */
+#undef off_t			/* Define to long if off_t missing */
+#undef size_t			/* Define to unsigned long if size_t missing */
+#undef ssize_t			/* Define to long if ssize_t missing */
+

--- zisofs_tools/configure	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/configure	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,2186 @@
+#! /bin/sh
+
+# Guess values for system-dependent variables and create Makefiles.
+# Generated automatically using autoconf version 2.13 
+# Copyright (C) 1992, 93, 94, 95, 96 Free Software Foundation, Inc.
+#
+# This configure script is free software; the Free Software Foundation
+# gives unlimited permission to copy, distribute and modify it.
+
+# Defaults:
+ac_help=
+ac_default_prefix=/usr/local
+# Any additions from configure.in:
+ac_default_prefix=/usr
+
+# Initialize some variables set by options.
+# The variables have the same names as the options, with
+# dashes changed to underlines.
+build=NONE
+cache_file=./config.cache
+exec_prefix=NONE
+host=NONE
+no_create=
+nonopt=NONE
+no_recursion=
+prefix=NONE
+program_prefix=NONE
+program_suffix=NONE
+program_transform_name=s,x,x,
+silent=
+site=
+srcdir=
+target=NONE
+verbose=
+x_includes=NONE
+x_libraries=NONE
+bindir='${exec_prefix}/bin'
+sbindir='${exec_prefix}/sbin'
+libexecdir='${exec_prefix}/libexec'
+datadir='${prefix}/share'
+sysconfdir='${prefix}/etc'
+sharedstatedir='${prefix}/com'
+localstatedir='${prefix}/var'
+libdir='${exec_prefix}/lib'
+includedir='${prefix}/include'
+oldincludedir='/usr/include'
+infodir='${prefix}/info'
+mandir='${prefix}/man'
+
+# Initialize some other variables.
+subdirs=
+MFLAGS= MAKEFLAGS=
+SHELL=${CONFIG_SHELL-/bin/sh}
+# Maximum number of lines to put in a shell here document.
+ac_max_here_lines=12
+
+ac_prev=
+for ac_option
+do
+
+  # If the previous option needs an argument, assign it.
+  if test -n "$ac_prev"; then
+    eval "$ac_prev=\$ac_option"
+    ac_prev=
+    continue
+  fi
+
+  case "$ac_option" in
+  -*=*) ac_optarg=`echo "$ac_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
+  *) ac_optarg= ;;
+  esac
+
+  # Accept the important Cygnus configure options, so we can diagnose typos.
+
+  case "$ac_option" in
+
+  -bindir | --bindir | --bindi | --bind | --bin | --bi)
+    ac_prev=bindir ;;
+  -bindir=* | --bindir=* | --bindi=* | --bind=* | --bin=* | --bi=*)
+    bindir="$ac_optarg" ;;
+
+  -build | --build | --buil | --bui | --bu)
+    ac_prev=build ;;
+  -build=* | --build=* | --buil=* | --bui=* | --bu=*)
+    build="$ac_optarg" ;;
+
+  -cache-file | --cache-file | --cache-fil | --cache-fi \
+  | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
+    ac_prev=cache_file ;;
+  -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
+  | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
+    cache_file="$ac_optarg" ;;
+
+  -datadir | --datadir | --datadi | --datad | --data | --dat | --da)
+    ac_prev=datadir ;;
+  -datadir=* | --datadir=* | --datadi=* | --datad=* | --data=* | --dat=* \
+  | --da=*)
+    datadir="$ac_optarg" ;;
+
+  -disable-* | --disable-*)
+    ac_feature=`echo $ac_option|sed -e 's/-*disable-//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_feature| sed 's/[-a-zA-Z0-9_]//g'`"; then
+      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
+    fi
+    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
+    eval "enable_${ac_feature}=no" ;;
+
+  -enable-* | --enable-*)
+    ac_feature=`echo $ac_option|sed -e 's/-*enable-//' -e 's/=.*//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_feature| sed 's/[-_a-zA-Z0-9]//g'`"; then
+      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
+    fi
+    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
+    case "$ac_option" in
+      *=*) ;;
+      *) ac_optarg=yes ;;
+    esac
+    eval "enable_${ac_feature}='$ac_optarg'" ;;
+
+  -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
+  | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
+  | --exec | --exe | --ex)
+    ac_prev=exec_prefix ;;
+  -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
+  | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
+  | --exec=* | --exe=* | --ex=*)
+    exec_prefix="$ac_optarg" ;;
+
+  -gas | --gas | --ga | --g)
+    # Obsolete; use --with-gas.
+    with_gas=yes ;;
+
+  -help | --help | --hel | --he)
+    # Omit some internal or obsolete options to make the list less imposing.
+    # This message is too long to be a string in the A/UX 3.1 sh.
+    cat << EOF
+Usage: configure [options] [host]
+Options: [defaults in brackets after descriptions]
+Configuration:
+  --cache-file=FILE       cache test results in FILE
+  --help                  print this message
+  --no-create             do not create output files
+  --quiet, --silent       do not print \`checking...' messages
+  --version               print the version of autoconf that created configure
+Directory and file names:
+  --prefix=PREFIX         install architecture-independent files in PREFIX
+                          [$ac_default_prefix]
+  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
+                          [same as prefix]
+  --bindir=DIR            user executables in DIR [EPREFIX/bin]
+  --sbindir=DIR           system admin executables in DIR [EPREFIX/sbin]
+  --libexecdir=DIR        program executables in DIR [EPREFIX/libexec]
+  --datadir=DIR           read-only architecture-independent data in DIR
+                          [PREFIX/share]
+  --sysconfdir=DIR        read-only single-machine data in DIR [PREFIX/etc]
+  --sharedstatedir=DIR    modifiable architecture-independent data in DIR
+                          [PREFIX/com]
+  --localstatedir=DIR     modifiable single-machine data in DIR [PREFIX/var]
+  --libdir=DIR            object code libraries in DIR [EPREFIX/lib]
+  --includedir=DIR        C header files in DIR [PREFIX/include]
+  --oldincludedir=DIR     C header files for non-gcc in DIR [/usr/include]
+  --infodir=DIR           info documentation in DIR [PREFIX/info]
+  --mandir=DIR            man documentation in DIR [PREFIX/man]
+  --srcdir=DIR            find the sources in DIR [configure dir or ..]
+  --program-prefix=PREFIX prepend PREFIX to installed program names
+  --program-suffix=SUFFIX append SUFFIX to installed program names
+  --program-transform-name=PROGRAM
+                          run sed PROGRAM on installed program names
+EOF
+    cat << EOF
+Host type:
+  --build=BUILD           configure for building on BUILD [BUILD=HOST]
+  --host=HOST             configure for HOST [guessed]
+  --target=TARGET         configure for TARGET [TARGET=HOST]
+Features and packages:
+  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
+  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
+  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
+  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
+  --x-includes=DIR        X include files are in DIR
+  --x-libraries=DIR       X library files are in DIR
+EOF
+    if test -n "$ac_help"; then
+      echo "--enable and --with options recognized:$ac_help"
+    fi
+    exit 0 ;;
+
+  -host | --host | --hos | --ho)
+    ac_prev=host ;;
+  -host=* | --host=* | --hos=* | --ho=*)
+    host="$ac_optarg" ;;
+
+  -includedir | --includedir | --includedi | --included | --include \
+  | --includ | --inclu | --incl | --inc)
+    ac_prev=includedir ;;
+  -includedir=* | --includedir=* | --includedi=* | --included=* | --include=* \
+  | --includ=* | --inclu=* | --incl=* | --inc=*)
+    includedir="$ac_optarg" ;;
+
+  -infodir | --infodir | --infodi | --infod | --info | --inf)
+    ac_prev=infodir ;;
+  -infodir=* | --infodir=* | --infodi=* | --infod=* | --info=* | --inf=*)
+    infodir="$ac_optarg" ;;
+
+  -libdir | --libdir | --libdi | --libd)
+    ac_prev=libdir ;;
+  -libdir=* | --libdir=* | --libdi=* | --libd=*)
+    libdir="$ac_optarg" ;;
+
+  -libexecdir | --libexecdir | --libexecdi | --libexecd | --libexec \
+  | --libexe | --libex | --libe)
+    ac_prev=libexecdir ;;
+  -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
+  | --libexe=* | --libex=* | --libe=*)
+    libexecdir="$ac_optarg" ;;
+
+  -localstatedir | --localstatedir | --localstatedi | --localstated \
+  | --localstate | --localstat | --localsta | --localst \
+  | --locals | --local | --loca | --loc | --lo)
+    ac_prev=localstatedir ;;
+  -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
+  | --localstate=* | --localstat=* | --localsta=* | --localst=* \
+  | --locals=* | --local=* | --loca=* | --loc=* | --lo=*)
+    localstatedir="$ac_optarg" ;;
+
+  -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
+    ac_prev=mandir ;;
+  -mandir=* | --mandir=* | --mandi=* | --mand=* | --man=* | --ma=* | --m=*)
+    mandir="$ac_optarg" ;;
+
+  -nfp | --nfp | --nf)
+    # Obsolete; use --without-fp.
+    with_fp=no ;;
+
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c)
+    no_create=yes ;;
+
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
+    no_recursion=yes ;;
+
+  -oldincludedir | --oldincludedir | --oldincludedi | --oldincluded \
+  | --oldinclude | --oldinclud | --oldinclu | --oldincl | --oldinc \
+  | --oldin | --oldi | --old | --ol | --o)
+    ac_prev=oldincludedir ;;
+  -oldincludedir=* | --oldincludedir=* | --oldincludedi=* | --oldincluded=* \
+  | --oldinclude=* | --oldinclud=* | --oldinclu=* | --oldincl=* | --oldinc=* \
+  | --oldin=* | --oldi=* | --old=* | --ol=* | --o=*)
+    oldincludedir="$ac_optarg" ;;
+
+  -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
+    ac_prev=prefix ;;
+  -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
+    prefix="$ac_optarg" ;;
+
+  -program-prefix | --program-prefix | --program-prefi | --program-pref \
+  | --program-pre | --program-pr | --program-p)
+    ac_prev=program_prefix ;;
+  -program-prefix=* | --program-prefix=* | --program-prefi=* \
+  | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
+    program_prefix="$ac_optarg" ;;
+
+  -program-suffix | --program-suffix | --program-suffi | --program-suff \
+  | --program-suf | --program-su | --program-s)
+    ac_prev=program_suffix ;;
+  -program-suffix=* | --program-suffix=* | --program-suffi=* \
+  | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
+    program_suffix="$ac_optarg" ;;
+
+  -program-transform-name | --program-transform-name \
+  | --program-transform-nam | --program-transform-na \
+  | --program-transform-n | --program-transform- \
+  | --program-transform | --program-transfor \
+  | --program-transfo | --program-transf \
+  | --program-trans | --program-tran \
+  | --progr-tra | --program-tr | --program-t)
+    ac_prev=program_transform_name ;;
+  -program-transform-name=* | --program-transform-name=* \
+  | --program-transform-nam=* | --program-transform-na=* \
+  | --program-transform-n=* | --program-transform-=* \
+  | --program-transform=* | --program-transfor=* \
+  | --program-transfo=* | --program-transf=* \
+  | --program-trans=* | --program-tran=* \
+  | --progr-tra=* | --program-tr=* | --program-t=*)
+    program_transform_name="$ac_optarg" ;;
+
+  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+  | -silent | --silent | --silen | --sile | --sil)
+    silent=yes ;;
+
+  -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
+    ac_prev=sbindir ;;
+  -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
+  | --sbi=* | --sb=*)
+    sbindir="$ac_optarg" ;;
+
+  -sharedstatedir | --sharedstatedir | --sharedstatedi \
+  | --sharedstated | --sharedstate | --sharedstat | --sharedsta \
+  | --sharedst | --shareds | --shared | --share | --shar \
+  | --sha | --sh)
+    ac_prev=sharedstatedir ;;
+  -sharedstatedir=* | --sharedstatedir=* | --sharedstatedi=* \
+  | --sharedstated=* | --sharedstate=* | --sharedstat=* | --sharedsta=* \
+  | --sharedst=* | --shareds=* | --shared=* | --share=* | --shar=* \
+  | --sha=* | --sh=*)
+    sharedstatedir="$ac_optarg" ;;
+
+  -site | --site | --sit)
+    ac_prev=site ;;
+  -site=* | --site=* | --sit=*)
+    site="$ac_optarg" ;;
+
+  -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
+    ac_prev=srcdir ;;
+  -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
+    srcdir="$ac_optarg" ;;
+
+  -sysconfdir | --sysconfdir | --sysconfdi | --sysconfd | --sysconf \
+  | --syscon | --sysco | --sysc | --sys | --sy)
+    ac_prev=sysconfdir ;;
+  -sysconfdir=* | --sysconfdir=* | --sysconfdi=* | --sysconfd=* | --sysconf=* \
+  | --syscon=* | --sysco=* | --sysc=* | --sys=* | --sy=*)
+    sysconfdir="$ac_optarg" ;;
+
+  -target | --target | --targe | --targ | --tar | --ta | --t)
+    ac_prev=target ;;
+  -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
+    target="$ac_optarg" ;;
+
+  -v | -verbose | --verbose | --verbos | --verbo | --verb)
+    verbose=yes ;;
+
+  -version | --version | --versio | --versi | --vers)
+    echo "configure generated by autoconf version 2.13"
+    exit 0 ;;
+
+  -with-* | --with-*)
+    ac_package=`echo $ac_option|sed -e 's/-*with-//' -e 's/=.*//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_package| sed 's/[-_a-zA-Z0-9]//g'`"; then
+      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
+    fi
+    ac_package=`echo $ac_package| sed 's/-/_/g'`
+    case "$ac_option" in
+      *=*) ;;
+      *) ac_optarg=yes ;;
+    esac
+    eval "with_${ac_package}='$ac_optarg'" ;;
+
+  -without-* | --without-*)
+    ac_package=`echo $ac_option|sed -e 's/-*without-//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_package| sed 's/[-a-zA-Z0-9_]//g'`"; then
+      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
+    fi
+    ac_package=`echo $ac_package| sed 's/-/_/g'`
+    eval "with_${ac_package}=no" ;;
+
+  --x)
+    # Obsolete; use --with-x.
+    with_x=yes ;;
+
+  -x-includes | --x-includes | --x-include | --x-includ | --x-inclu \
+  | --x-incl | --x-inc | --x-in | --x-i)
+    ac_prev=x_includes ;;
+  -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
+  | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
+    x_includes="$ac_optarg" ;;
+
+  -x-libraries | --x-libraries | --x-librarie | --x-librari \
+  | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
+    ac_prev=x_libraries ;;
+  -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
+  | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
+    x_libraries="$ac_optarg" ;;
+
+  -*) { echo "configure: error: $ac_option: invalid option; use --help to show usage" 1>&2; exit 1; }
+    ;;
+
+  *)
+    if test -n "`echo $ac_option| sed 's/[-a-z0-9.]//g'`"; then
+      echo "configure: warning: $ac_option: invalid host type" 1>&2
+    fi
+    if test "x$nonopt" != xNONE; then
+      { echo "configure: error: can only configure for one host and one target at a time" 1>&2; exit 1; }
+    fi
+    nonopt="$ac_option"
+    ;;
+
+  esac
+done
+
+if test -n "$ac_prev"; then
+  { echo "configure: error: missing argument to --`echo $ac_prev | sed 's/_/-/g'`" 1>&2; exit 1; }
+fi
+
+trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
+
+# File descriptor usage:
+# 0 standard input
+# 1 file creation
+# 2 errors and warnings
+# 3 some systems may open it to /dev/tty
+# 4 used on the Kubota Titan
+# 6 checking for... messages and results
+# 5 compiler messages saved in config.log
+if test "$silent" = yes; then
+  exec 6>/dev/null
+else
+  exec 6>&1
+fi
+exec 5>./config.log
+
+echo "\
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
+" 1>&5
+
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Also quote any args containing shell metacharacters.
+ac_configure_args=
+for ac_arg
+do
+  case "$ac_arg" in
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c) ;;
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r) ;;
+  *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?]*)
+  ac_configure_args="$ac_configure_args '$ac_arg'" ;;
+  *) ac_configure_args="$ac_configure_args $ac_arg" ;;
+  esac
+done
+
+# NLS nuisances.
+# Only set these to C if already set.  These must not be set unconditionally
+# because not all systems understand e.g. LANG=C (notably SCO).
+# Fixing LC_MESSAGES prevents Solaris sh from translating var values in `set'!
+# Non-C LC_CTYPE values break the ctype check.
+if test "${LANG+set}"   = set; then LANG=C;   export LANG;   fi
+if test "${LC_ALL+set}" = set; then LC_ALL=C; export LC_ALL; fi
+if test "${LC_MESSAGES+set}" = set; then LC_MESSAGES=C; export LC_MESSAGES; fi
+if test "${LC_CTYPE+set}"    = set; then LC_CTYPE=C;    export LC_CTYPE;    fi
+
+# confdefs.h avoids OS command line length limits that DEFS can exceed.
+rm -rf conftest* confdefs.h
+# AIX cpp loses on an empty file, so make sure it contains at least a newline.
+echo > confdefs.h
+
+# A filename unique to this package, relative to the directory that
+# configure is in, which we can look for to find out if srcdir is correct.
+ac_unique_file=MCONFIG.in
+
+# Find the source files, if location was not specified.
+if test -z "$srcdir"; then
+  ac_srcdir_defaulted=yes
+  # Try the directory containing this script, then its parent.
+  ac_prog=$0
+  ac_confdir=`echo $ac_prog|sed 's%/[^/][^/]*$%%'`
+  test "x$ac_confdir" = "x$ac_prog" && ac_confdir=.
+  srcdir=$ac_confdir
+  if test ! -r $srcdir/$ac_unique_file; then
+    srcdir=..
+  fi
+else
+  ac_srcdir_defaulted=no
+fi
+if test ! -r $srcdir/$ac_unique_file; then
+  if test "$ac_srcdir_defaulted" = yes; then
+    { echo "configure: error: can not find sources in $ac_confdir or .." 1>&2; exit 1; }
+  else
+    { echo "configure: error: can not find sources in $srcdir" 1>&2; exit 1; }
+  fi
+fi
+srcdir=`echo "${srcdir}" | sed 's%\([^/]\)/*$%\1%'`
+
+# Prefer explicitly selected file to automatically selected ones.
+if test -z "$CONFIG_SITE"; then
+  if test "x$prefix" != xNONE; then
+    CONFIG_SITE="$prefix/share/config.site $prefix/etc/config.site"
+  else
+    CONFIG_SITE="$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site"
+  fi
+fi
+for ac_site_file in $CONFIG_SITE; do
+  if test -r "$ac_site_file"; then
+    echo "loading site script $ac_site_file"
+    . "$ac_site_file"
+  fi
+done
+
+if test -r "$cache_file"; then
+  echo "loading cache $cache_file"
+  . $cache_file
+else
+  echo "creating cache $cache_file"
+  > $cache_file
+fi
+
+ac_ext=c
+# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
+cross_compiling=$ac_cv_prog_cc_cross
+
+ac_exeext=
+ac_objext=o
+if (echo "testing\c"; echo 1,2,3) | grep c >/dev/null; then
+  # Stardent Vistra SVR4 grep lacks -e, says ghazi@caip.rutgers.edu.
+  if (echo -n testing; echo 1,2,3) | sed s/-n/xn/ | grep xn >/dev/null; then
+    ac_n= ac_c='
+' ac_t='	'
+  else
+    ac_n=-n ac_c= ac_t=
+  fi
+else
+  ac_n= ac_c='\c' ac_t=
+fi
+
+
+
+
+# Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:531: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_CC="gcc"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:561: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_prog_rejected=no
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      if test "$ac_dir/$ac_word" = "/usr/ucb/cc"; then
+        ac_prog_rejected=yes
+	continue
+      fi
+      ac_cv_prog_CC="cc"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# -gt 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    set dummy "$ac_dir/$ac_word" "$@"
+    shift
+    ac_cv_prog_CC="$@"
+  fi
+fi
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+  if test -z "$CC"; then
+    case "`uname -s`" in
+    *win32* | *WIN32*)
+      # Extract the first word of "cl", so it can be a program name with args.
+set dummy cl; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:612: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_CC="cl"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+ ;;
+    esac
+  fi
+  test -z "$CC" && { echo "configure: error: no acceptable cc found in \$PATH" 1>&2; exit 1; }
+fi
+
+echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works""... $ac_c" 1>&6
+echo "configure:644: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
+
+ac_ext=c
+# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
+cross_compiling=$ac_cv_prog_cc_cross
+
+cat > conftest.$ac_ext << EOF
+
+#line 655 "configure"
+#include "confdefs.h"
+
+main(){return(0);}
+EOF
+if { (eval echo configure:660: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  ac_cv_prog_cc_works=yes
+  # If we can't run a trivial program, we are probably using a cross compiler.
+  if (./conftest; exit) 2>/dev/null; then
+    ac_cv_prog_cc_cross=no
+  else
+    ac_cv_prog_cc_cross=yes
+  fi
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_cv_prog_cc_works=no
+fi
+rm -fr conftest*
+ac_ext=c
+# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
+cross_compiling=$ac_cv_prog_cc_cross
+
+echo "$ac_t""$ac_cv_prog_cc_works" 1>&6
+if test $ac_cv_prog_cc_works = no; then
+  { echo "configure: error: installation or configuration problem: C compiler cannot create executables." 1>&2; exit 1; }
+fi
+echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler""... $ac_c" 1>&6
+echo "configure:686: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
+echo "$ac_t""$ac_cv_prog_cc_cross" 1>&6
+cross_compiling=$ac_cv_prog_cc_cross
+
+echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
+echo "configure:691: checking whether we are using GNU C" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.c <<EOF
+#ifdef __GNUC__
+  yes;
+#endif
+EOF
+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:700: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
+  ac_cv_prog_gcc=yes
+else
+  ac_cv_prog_gcc=no
+fi
+fi
+
+echo "$ac_t""$ac_cv_prog_gcc" 1>&6
+
+if test $ac_cv_prog_gcc = yes; then
+  GCC=yes
+else
+  GCC=
+fi
+
+ac_test_CFLAGS="${CFLAGS+set}"
+ac_save_CFLAGS="$CFLAGS"
+CFLAGS=
+echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
+echo "configure:719: checking whether ${CC-cc} accepts -g" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_cc_g'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  echo 'void f(){}' > conftest.c
+if test -z "`${CC-cc} -g -c conftest.c 2>&1`"; then
+  ac_cv_prog_cc_g=yes
+else
+  ac_cv_prog_cc_g=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_prog_cc_g" 1>&6
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS="$ac_save_CFLAGS"
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
+  fi
+else
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
+fi
+
+echo $ac_n "checking for working const""... $ac_c" 1>&6
+echo "configure:751: checking for working const" >&5
+if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 756 "configure"
+#include "confdefs.h"
+
+int main() {
+
+/* Ultrix mips cc rejects this.  */
+typedef int charset[2]; const charset x;
+/* SunOS 4.1.1 cc rejects this.  */
+char const *const *ccp;
+char **p;
+/* NEC SVR4.0.2 mips cc rejects this.  */
+struct point {int x, y;};
+static struct point const zero = {0,0};
+/* AIX XL C 1.02.0.0 rejects this.
+   It does not let you subtract one const X* pointer from another in an arm
+   of an if-expression whose if-part is not a constant expression */
+const char *g = "string";
+ccp = &g + (g ? g-g : 0);
+/* HPUX 7.0 cc rejects these. */
+++ccp;
+p = (char**) ccp;
+ccp = (char const *const *) p;
+{ /* SCO 3.2v4 cc rejects this.  */
+  char *t;
+  char const *s = 0 ? (char *) 0 : (char const *) 0;
+
+  *t++ = 0;
+}
+{ /* Someone thinks the Sun supposedly-ANSI compiler will reject this.  */
+  int x[] = {25, 17};
+  const int *foo = &x[0];
+  ++foo;
+}
+{ /* Sun SC1.0 ANSI compiler rejects this -- but not the above. */
+  typedef const int *iptr;
+  iptr p = 0;
+  ++p;
+}
+{ /* AIX XL C 1.02.0.0 rejects this saying
+     "k.c", line 2.27: 1506-025 (S) Operand must be a modifiable lvalue. */
+  struct s { int j; const int *ap[3]; };
+  struct s *b; b->j = 5;
+}
+{ /* ULTRIX-32 V3.1 (Rev 9) vcc rejects this */
+  const int foo = 10;
+}
+
+; return 0; }
+EOF
+if { (eval echo configure:805: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_c_const=yes
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_c_const=no
+fi
+rm -f conftest*
+fi
+
+echo "$ac_t""$ac_cv_c_const" 1>&6
+if test $ac_cv_c_const = no; then
+  cat >> confdefs.h <<\EOF
+#define const 
+EOF
+
+fi
+
+echo $ac_n "checking for inline""... $ac_c" 1>&6
+echo "configure:826: checking for inline" >&5
+if eval "test \"`echo '$''{'ac_cv_c_inline'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_cv_c_inline=no
+for ac_kw in inline __inline__ __inline; do
+  cat > conftest.$ac_ext <<EOF
+#line 833 "configure"
+#include "confdefs.h"
+
+int main() {
+} $ac_kw foo() {
+; return 0; }
+EOF
+if { (eval echo configure:840: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_c_inline=$ac_kw; break
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+fi
+rm -f conftest*
+done
+
+fi
+
+echo "$ac_t""$ac_cv_c_inline" 1>&6
+case "$ac_cv_c_inline" in
+  inline | yes) ;;
+  no) cat >> confdefs.h <<\EOF
+#define inline 
+EOF
+ ;;
+  *)  cat >> confdefs.h <<EOF
+#define inline $ac_cv_c_inline
+EOF
+ ;;
+esac
+
+
+echo $ac_n "checking if $CC accepts -Wall""... $ac_c" 1>&6
+echo "configure:867: checking if $CC accepts -Wall" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wall"
+ cat > conftest.$ac_ext <<EOF
+#line 871 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:878: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -W""... $ac_c" 1>&6
+echo "configure:890: checking if $CC accepts -W" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -W"
+ cat > conftest.$ac_ext <<EOF
+#line 894 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:901: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wpointer-arith""... $ac_c" 1>&6
+echo "configure:913: checking if $CC accepts -Wpointer-arith" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wpointer-arith"
+ cat > conftest.$ac_ext <<EOF
+#line 917 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:924: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wbad-function-cast""... $ac_c" 1>&6
+echo "configure:936: checking if $CC accepts -Wbad-function-cast" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wbad-function-cast"
+ cat > conftest.$ac_ext <<EOF
+#line 940 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:947: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wcast-equal""... $ac_c" 1>&6
+echo "configure:959: checking if $CC accepts -Wcast-equal" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wcast-equal"
+ cat > conftest.$ac_ext <<EOF
+#line 963 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:970: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wstrict-prototypes""... $ac_c" 1>&6
+echo "configure:982: checking if $CC accepts -Wstrict-prototypes" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wstrict-prototypes"
+ cat > conftest.$ac_ext <<EOF
+#line 986 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:993: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wmissing-prototypes""... $ac_c" 1>&6
+echo "configure:1005: checking if $CC accepts -Wmissing-prototypes" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wmissing-prototypes"
+ cat > conftest.$ac_ext <<EOF
+#line 1009 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:1016: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wmissing-declarations""... $ac_c" 1>&6
+echo "configure:1028: checking if $CC accepts -Wmissing-declarations" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wmissing-declarations"
+ cat > conftest.$ac_ext <<EOF
+#line 1032 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:1039: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wnested-externs""... $ac_c" 1>&6
+echo "configure:1051: checking if $CC accepts -Wnested-externs" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wnested-externs"
+ cat > conftest.$ac_ext <<EOF
+#line 1055 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:1062: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Winline""... $ac_c" 1>&6
+echo "configure:1074: checking if $CC accepts -Winline" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Winline"
+ cat > conftest.$ac_ext <<EOF
+#line 1078 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:1085: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wshadow""... $ac_c" 1>&6
+echo "configure:1097: checking if $CC accepts -Wshadow" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wshadow"
+ cat > conftest.$ac_ext <<EOF
+#line 1101 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:1108: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -Wcast-align""... $ac_c" 1>&6
+echo "configure:1120: checking if $CC accepts -Wcast-align" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -Wcast-align"
+ cat > conftest.$ac_ext <<EOF
+#line 1124 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:1131: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+echo $ac_n "checking if $CC accepts -pipe""... $ac_c" 1>&6
+echo "configure:1143: checking if $CC accepts -pipe" >&5
+ pa_add_cflags__old_cflags="$CFLAGS"
+ CFLAGS="$CFLAGS -pipe"
+ cat > conftest.$ac_ext <<EOF
+#line 1147 "configure"
+#include "confdefs.h"
+#include <stdio.h>
+int main() {
+printf("Hello, World!\n");
+; return 0; }
+EOF
+if { (eval echo configure:1154: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+ CFLAGS="$pa_add_cflags__old_cflags"
+fi
+rm -f conftest*
+
+echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
+echo "configure:1167: checking how to run the C preprocessor" >&5
+# On Suns, sometimes $CPP names a directory.
+if test -n "$CPP" && test -d "$CPP"; then
+  CPP=
+fi
+if test -z "$CPP"; then
+if eval "test \"`echo '$''{'ac_cv_prog_CPP'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+    # This must be in double quotes, not single quotes, because CPP may get
+  # substituted into the Makefile and "${CC-cc}" will confuse make.
+  CPP="${CC-cc} -E"
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp.
+  cat > conftest.$ac_ext <<EOF
+#line 1182 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1188: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  CPP="${CC-cc} -E -traditional-cpp"
+  cat > conftest.$ac_ext <<EOF
+#line 1199 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1205: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  CPP="${CC-cc} -nologo -E"
+  cat > conftest.$ac_ext <<EOF
+#line 1216 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1222: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  CPP=/lib/cpp
+fi
+rm -f conftest*
+fi
+rm -f conftest*
+fi
+rm -f conftest*
+  ac_cv_prog_CPP="$CPP"
+fi
+  CPP="$ac_cv_prog_CPP"
+else
+  ac_cv_prog_CPP="$CPP"
+fi
+echo "$ac_t""$CPP" 1>&6
+
+for ac_hdr in sysexits.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:1250: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1255 "configure"
+#include "confdefs.h"
+#include <$ac_hdr>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1260: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
+else
+  echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
+fi
+rm -f conftest*
+fi
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
+EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
+
+for ac_hdr in getopt.h
+do
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:1290: checking for $ac_hdr" >&5
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1295 "configure"
+#include "confdefs.h"
+#include <$ac_hdr>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1300: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
+else
+  echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
+fi
+rm -f conftest*
+fi
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
+EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
+
+
+echo $ac_n "checking for ANSI C header files""... $ac_c" 1>&6
+echo "configure:1328: checking for ANSI C header files" >&5
+if eval "test \"`echo '$''{'ac_cv_header_stdc'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1333 "configure"
+#include "confdefs.h"
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <float.h>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1341: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  ac_cv_header_stdc=yes
+else
+  echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+if test $ac_cv_header_stdc = yes; then
+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
+cat > conftest.$ac_ext <<EOF
+#line 1358 "configure"
+#include "confdefs.h"
+#include <string.h>
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "memchr" >/dev/null 2>&1; then
+  :
+else
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+cat > conftest.$ac_ext <<EOF
+#line 1376 "configure"
+#include "confdefs.h"
+#include <stdlib.h>
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "free" >/dev/null 2>&1; then
+  :
+else
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
+if test "$cross_compiling" = yes; then
+  :
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1397 "configure"
+#include "confdefs.h"
+#include <ctype.h>
+#define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
+#define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
+int main () { int i; for (i = 0; i < 256; i++)
+if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);
+exit (0); }
+
+EOF
+if { (eval echo configure:1408: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  :
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -fr conftest*
+  ac_cv_header_stdc=no
+fi
+rm -fr conftest*
+fi
+
+fi
+fi
+
+echo "$ac_t""$ac_cv_header_stdc" 1>&6
+if test $ac_cv_header_stdc = yes; then
+  cat >> confdefs.h <<\EOF
+#define STDC_HEADERS 1
+EOF
+
+fi
+
+echo $ac_n "checking for off_t""... $ac_c" 1>&6
+echo "configure:1432: checking for off_t" >&5
+if eval "test \"`echo '$''{'ac_cv_type_off_t'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1437 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#if STDC_HEADERS
+#include <stdlib.h>
+#include <stddef.h>
+#endif
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "(^|[^a-zA-Z_0-9])off_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  rm -rf conftest*
+  ac_cv_type_off_t=yes
+else
+  rm -rf conftest*
+  ac_cv_type_off_t=no
+fi
+rm -f conftest*
+
+fi
+echo "$ac_t""$ac_cv_type_off_t" 1>&6
+if test $ac_cv_type_off_t = no; then
+  cat >> confdefs.h <<\EOF
+#define off_t signed long
+EOF
+
+fi
+
+echo $ac_n "checking for size_t""... $ac_c" 1>&6
+echo "configure:1465: checking for size_t" >&5
+if eval "test \"`echo '$''{'ac_cv_type_size_t'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1470 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#if STDC_HEADERS
+#include <stdlib.h>
+#include <stddef.h>
+#endif
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "(^|[^a-zA-Z_0-9])size_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  rm -rf conftest*
+  ac_cv_type_size_t=yes
+else
+  rm -rf conftest*
+  ac_cv_type_size_t=no
+fi
+rm -f conftest*
+
+fi
+echo "$ac_t""$ac_cv_type_size_t" 1>&6
+if test $ac_cv_type_size_t = no; then
+  cat >> confdefs.h <<\EOF
+#define size_t unsigned long
+EOF
+
+fi
+
+echo $ac_n "checking for ssize_t""... $ac_c" 1>&6
+echo "configure:1498: checking for ssize_t" >&5
+if eval "test \"`echo '$''{'ac_cv_type_ssize_t'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1503 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#if STDC_HEADERS
+#include <stdlib.h>
+#include <stddef.h>
+#endif
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "(^|[^a-zA-Z_0-9])ssize_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+  rm -rf conftest*
+  ac_cv_type_ssize_t=yes
+else
+  rm -rf conftest*
+  ac_cv_type_ssize_t=no
+fi
+rm -f conftest*
+
+fi
+echo "$ac_t""$ac_cv_type_ssize_t" 1>&6
+if test $ac_cv_type_ssize_t = no; then
+  cat >> confdefs.h <<\EOF
+#define ssize_t signed long
+EOF
+
+fi
+
+
+for ac_func in lchown
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:1534: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1539 "configure"
+#include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
+
+int main() {
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
+; return 0; }
+EOF
+if { (eval echo configure:1562: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
+fi
+rm -f conftest*
+fi
+
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
+EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
+
+
+
+echo $ac_n "checking for library containing compress2""... $ac_c" 1>&6
+echo "configure:1589: checking for library containing compress2" >&5
+if eval "test \"`echo '$''{'ac_cv_search_compress2'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_func_search_save_LIBS="$LIBS"
+ac_cv_search_compress2="no"
+cat > conftest.$ac_ext <<EOF
+#line 1596 "configure"
+#include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char compress2();
+
+int main() {
+compress2()
+; return 0; }
+EOF
+if { (eval echo configure:1607: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_search_compress2="none required"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+fi
+rm -f conftest*
+test "$ac_cv_search_compress2" = "no" && for i in z; do
+LIBS="-l$i  $ac_func_search_save_LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 1618 "configure"
+#include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char compress2();
+
+int main() {
+compress2()
+; return 0; }
+EOF
+if { (eval echo configure:1629: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_search_compress2="-l$i"
+break
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+fi
+rm -f conftest*
+done
+LIBS="$ac_func_search_save_LIBS"
+fi
+
+echo "$ac_t""$ac_cv_search_compress2" 1>&6
+if test "$ac_cv_search_compress2" != "no"; then
+  test "$ac_cv_search_compress2" = "none required" || LIBS="$ac_cv_search_compress2 $LIBS"
+  
+else :
+  { echo "configure: error: zlib not found" 1>&2; exit 1; }
+fi
+
+echo $ac_n "checking for library containing getopt_long""... $ac_c" 1>&6
+echo "configure:1651: checking for library containing getopt_long" >&5
+if eval "test \"`echo '$''{'ac_cv_search_getopt_long'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_func_search_save_LIBS="$LIBS"
+ac_cv_search_getopt_long="no"
+cat > conftest.$ac_ext <<EOF
+#line 1658 "configure"
+#include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char getopt_long();
+
+int main() {
+getopt_long()
+; return 0; }
+EOF
+if { (eval echo configure:1669: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_search_getopt_long="none required"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+fi
+rm -f conftest*
+test "$ac_cv_search_getopt_long" = "no" && for i in getopt getopt_long; do
+LIBS="-l$i  $ac_func_search_save_LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 1680 "configure"
+#include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char getopt_long();
+
+int main() {
+getopt_long()
+; return 0; }
+EOF
+if { (eval echo configure:1691: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  ac_cv_search_getopt_long="-l$i"
+break
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+fi
+rm -f conftest*
+done
+LIBS="$ac_func_search_save_LIBS"
+fi
+
+echo "$ac_t""$ac_cv_search_getopt_long" 1>&6
+if test "$ac_cv_search_getopt_long" != "no"; then
+  test "$ac_cv_search_getopt_long" = "none required" || LIBS="$ac_cv_search_getopt_long $LIBS"
+  cat >> confdefs.h <<\EOF
+#define HAVE_GETOPT_LONG 1
+EOF
+
+else :
+  
+fi
+
+# Extract the first word of "ranlib", so it can be a program name with args.
+set dummy ranlib; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1718: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$RANLIB"; then
+  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_RANLIB="ranlib"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  test -z "$ac_cv_prog_RANLIB" && ac_cv_prog_RANLIB=":"
+fi
+fi
+RANLIB="$ac_cv_prog_RANLIB"
+if test -n "$RANLIB"; then
+  echo "$ac_t""$RANLIB" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+ac_aux_dir=
+for ac_dir in $srcdir $srcdir/.. $srcdir/../..; do
+  if test -f $ac_dir/install-sh; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install-sh -c"
+    break
+  elif test -f $ac_dir/install.sh; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install.sh -c"
+    break
+  fi
+done
+if test -z "$ac_aux_dir"; then
+  { echo "configure: error: can not find install-sh or install.sh in $srcdir $srcdir/.. $srcdir/../.." 1>&2; exit 1; }
+fi
+ac_config_guess=$ac_aux_dir/config.guess
+ac_config_sub=$ac_aux_dir/config.sub
+ac_configure=$ac_aux_dir/configure # This should be Cygnus configure.
+
+# Find a good install program.  We prefer a C program (faster),
+# so one script is as good as another.  But avoid the broken or
+# incompatible versions:
+# SysV /etc/install, /usr/sbin/install
+# SunOS /usr/etc/install
+# IRIX /sbin/install
+# AIX /bin/install
+# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
+# AFS /usr/afsws/bin/install, which mishandles nonexistent args
+# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
+# ./install, which can be erroneously created by make from ./install.sh.
+echo $ac_n "checking for a BSD compatible install""... $ac_c" 1>&6
+echo "configure:1776: checking for a BSD compatible install" >&5
+if test -z "$INSTALL"; then
+if eval "test \"`echo '$''{'ac_cv_path_install'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+    IFS="${IFS= 	}"; ac_save_IFS="$IFS"; IFS=":"
+  for ac_dir in $PATH; do
+    # Account for people who put trailing slashes in PATH elements.
+    case "$ac_dir/" in
+    /|./|.//|/etc/*|/usr/sbin/*|/usr/etc/*|/sbin/*|/usr/afsws/bin/*|/usr/ucb/*) ;;
+    *)
+      # OSF1 and SCO ODT 3.0 have their own names for install.
+      # Don't use installbsd from OSF since it installs stuff as root
+      # by default.
+      for ac_prog in ginstall scoinst install; do
+        if test -f $ac_dir/$ac_prog; then
+	  if test $ac_prog = install &&
+            grep dspmsg $ac_dir/$ac_prog >/dev/null 2>&1; then
+	    # AIX install.  It has an incompatible calling convention.
+	    :
+	  else
+	    ac_cv_path_install="$ac_dir/$ac_prog -c"
+	    break 2
+	  fi
+	fi
+      done
+      ;;
+    esac
+  done
+  IFS="$ac_save_IFS"
+
+fi
+  if test "${ac_cv_path_install+set}" = set; then
+    INSTALL="$ac_cv_path_install"
+  else
+    # As a last resort, use the slow shell script.  We don't cache a
+    # path for INSTALL within a source directory, because that will
+    # break other packages using the cache if that directory is
+    # removed, or if the path is relative.
+    INSTALL="$ac_install_sh"
+  fi
+fi
+echo "$ac_t""$INSTALL" 1>&6
+
+# Use test -z because SunOS4 sh mishandles braces in ${var-val}.
+# It thinks the first close brace ends the variable substitution.
+test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
+
+test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL_PROGRAM}'
+
+test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
+
+
+
+trap '' 1 2 15
+cat > confcache <<\EOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs.  It is not useful on other systems.
+# If it contains results you don't want to keep, you may remove or edit it.
+#
+# By default, configure uses ./config.cache as the cache file,
+# creating it if it does not exist already.  You can give configure
+# the --cache-file=FILE option to use a different cache file; that is
+# what configure does when it calls configure scripts in
+# subdirectories, so they share the cache.
+# Giving --cache-file=/dev/null disables caching, for debugging configure.
+# config.status only pays attention to the cache file if you give it the
+# --recheck option to rerun configure.
+#
+EOF
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, don't put newlines in cache variables' values.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(set) 2>&1 |
+  case `(ac_space=' '; set | grep ac_space) 2>&1` in
+  *ac_space=\ *)
+    # `set' does not quote correctly, so add quotes (double-quote substitution
+    # turns \\\\ into \\, and sed turns \\ into \).
+    sed -n \
+      -e "s/'/'\\\\''/g" \
+      -e "s/^\\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\\)=\\(.*\\)/\\1=\${\\1='\\2'}/p"
+    ;;
+  *)
+    # `set' quotes correctly as required by POSIX, so do not add quotes.
+    sed -n -e 's/^\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\)=\(.*\)/\1=${\1=\2}/p'
+    ;;
+  esac >> confcache
+if cmp -s $cache_file confcache; then
+  :
+else
+  if test -w $cache_file; then
+    echo "updating cache $cache_file"
+    cat confcache > $cache_file
+  else
+    echo "not updating unwritable cache $cache_file"
+  fi
+fi
+rm -f confcache
+
+trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
+
+test "x$prefix" = xNONE && prefix=$ac_default_prefix
+# Let make expand exec_prefix.
+test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
+
+# Any assignment to VPATH causes Sun make to only execute
+# the first set of double-colon rules, so remove it if not needed.
+# If there is a colon in the path, we need to keep it.
+if test "x$srcdir" = x.; then
+  ac_vpsub='/^[ 	]*VPATH[ 	]*=[^:]*$/d'
+fi
+
+trap 'rm -f $CONFIG_STATUS conftest*; exit 1' 1 2 15
+
+DEFS=-DHAVE_CONFIG_H
+
+# Without the "./", some shells look in PATH for config.status.
+: ${CONFIG_STATUS=./config.status}
+
+echo creating $CONFIG_STATUS
+rm -f $CONFIG_STATUS
+cat > $CONFIG_STATUS <<EOF
+#! /bin/sh
+# Generated automatically by configure.
+# Run this file to recreate the current configuration.
+# This directory was configured as follows,
+# on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
+#
+# $0 $ac_configure_args
+#
+# Compiler output produced by configure, useful for debugging
+# configure, is in ./config.log if it exists.
+
+ac_cs_usage="Usage: $CONFIG_STATUS [--recheck] [--version] [--help]"
+for ac_option
+do
+  case "\$ac_option" in
+  -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
+    echo "running \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion"
+    exec \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion ;;
+  -version | --version | --versio | --versi | --vers | --ver | --ve | --v)
+    echo "$CONFIG_STATUS generated by autoconf version 2.13"
+    exit 0 ;;
+  -help | --help | --hel | --he | --h)
+    echo "\$ac_cs_usage"; exit 0 ;;
+  *) echo "\$ac_cs_usage"; exit 1 ;;
+  esac
+done
+
+ac_given_srcdir=$srcdir
+ac_given_INSTALL="$INSTALL"
+
+trap 'rm -fr `echo "MCONFIG config.h" | sed "s/:[^ ]*//g"` conftest*; exit 1' 1 2 15
+EOF
+cat >> $CONFIG_STATUS <<EOF
+
+# Protect against being on the right side of a sed subst in config.status.
+sed 's/%@/@@/; s/@%/@@/; s/%g\$/@g/; /@g\$/s/[\\\\&%]/\\\\&/g;
+ s/@@/%@/; s/@@/@%/; s/@g\$/%g/' > conftest.subs <<\\CEOF
+$ac_vpsub
+$extrasub
+s%@SHELL@%$SHELL%g
+s%@CFLAGS@%$CFLAGS%g
+s%@CPPFLAGS@%$CPPFLAGS%g
+s%@CXXFLAGS@%$CXXFLAGS%g
+s%@FFLAGS@%$FFLAGS%g
+s%@DEFS@%$DEFS%g
+s%@LDFLAGS@%$LDFLAGS%g
+s%@LIBS@%$LIBS%g
+s%@exec_prefix@%$exec_prefix%g
+s%@prefix@%$prefix%g
+s%@program_transform_name@%$program_transform_name%g
+s%@bindir@%$bindir%g
+s%@sbindir@%$sbindir%g
+s%@libexecdir@%$libexecdir%g
+s%@datadir@%$datadir%g
+s%@sysconfdir@%$sysconfdir%g
+s%@sharedstatedir@%$sharedstatedir%g
+s%@localstatedir@%$localstatedir%g
+s%@libdir@%$libdir%g
+s%@includedir@%$includedir%g
+s%@oldincludedir@%$oldincludedir%g
+s%@infodir@%$infodir%g
+s%@mandir@%$mandir%g
+s%@CC@%$CC%g
+s%@CPP@%$CPP%g
+s%@RANLIB@%$RANLIB%g
+s%@INSTALL_PROGRAM@%$INSTALL_PROGRAM%g
+s%@INSTALL_SCRIPT@%$INSTALL_SCRIPT%g
+s%@INSTALL_DATA@%$INSTALL_DATA%g
+
+CEOF
+EOF
+
+cat >> $CONFIG_STATUS <<\EOF
+
+# Split the substitutions into bite-sized pieces for seds with
+# small command number limits, like on Digital OSF/1 and HP-UX.
+ac_max_sed_cmds=90 # Maximum number of lines to put in a sed script.
+ac_file=1 # Number of current file.
+ac_beg=1 # First line for current file.
+ac_end=$ac_max_sed_cmds # Line after last line for current file.
+ac_more_lines=:
+ac_sed_cmds=""
+while $ac_more_lines; do
+  if test $ac_beg -gt 1; then
+    sed "1,${ac_beg}d; ${ac_end}q" conftest.subs > conftest.s$ac_file
+  else
+    sed "${ac_end}q" conftest.subs > conftest.s$ac_file
+  fi
+  if test ! -s conftest.s$ac_file; then
+    ac_more_lines=false
+    rm -f conftest.s$ac_file
+  else
+    if test -z "$ac_sed_cmds"; then
+      ac_sed_cmds="sed -f conftest.s$ac_file"
+    else
+      ac_sed_cmds="$ac_sed_cmds | sed -f conftest.s$ac_file"
+    fi
+    ac_file=`expr $ac_file + 1`
+    ac_beg=$ac_end
+    ac_end=`expr $ac_end + $ac_max_sed_cmds`
+  fi
+done
+if test -z "$ac_sed_cmds"; then
+  ac_sed_cmds=cat
+fi
+EOF
+
+cat >> $CONFIG_STATUS <<EOF
+
+CONFIG_FILES=\${CONFIG_FILES-"MCONFIG"}
+EOF
+cat >> $CONFIG_STATUS <<\EOF
+for ac_file in .. $CONFIG_FILES; do if test "x$ac_file" != x..; then
+  # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
+  case "$ac_file" in
+  *:*) ac_file_in=`echo "$ac_file"|sed 's%[^:]*:%%'`
+       ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
+  *) ac_file_in="${ac_file}.in" ;;
+  esac
+
+  # Adjust a relative srcdir, top_srcdir, and INSTALL for subdirectories.
+
+  # Remove last slash and all that follows it.  Not all systems have dirname.
+  ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
+  if test "$ac_dir" != "$ac_file" && test "$ac_dir" != .; then
+    # The file is in a subdirectory.
+    test ! -d "$ac_dir" && mkdir "$ac_dir"
+    ac_dir_suffix="/`echo $ac_dir|sed 's%^\./%%'`"
+    # A "../" for each directory in $ac_dir_suffix.
+    ac_dots=`echo $ac_dir_suffix|sed 's%/[^/]*%../%g'`
+  else
+    ac_dir_suffix= ac_dots=
+  fi
+
+  case "$ac_given_srcdir" in
+  .)  srcdir=.
+      if test -z "$ac_dots"; then top_srcdir=.
+      else top_srcdir=`echo $ac_dots|sed 's%/$%%'`; fi ;;
+  /*) srcdir="$ac_given_srcdir$ac_dir_suffix"; top_srcdir="$ac_given_srcdir" ;;
+  *) # Relative path.
+    srcdir="$ac_dots$ac_given_srcdir$ac_dir_suffix"
+    top_srcdir="$ac_dots$ac_given_srcdir" ;;
+  esac
+
+  case "$ac_given_INSTALL" in
+  [/$]*) INSTALL="$ac_given_INSTALL" ;;
+  *) INSTALL="$ac_dots$ac_given_INSTALL" ;;
+  esac
+
+  echo creating "$ac_file"
+  rm -f "$ac_file"
+  configure_input="Generated automatically from `echo $ac_file_in|sed 's%.*/%%'` by configure."
+  case "$ac_file" in
+  *Makefile*) ac_comsub="1i\\
+# $configure_input" ;;
+  *) ac_comsub= ;;
+  esac
+
+  ac_file_inputs=`echo $ac_file_in|sed -e "s%^%$ac_given_srcdir/%" -e "s%:% $ac_given_srcdir/%g"`
+  sed -e "$ac_comsub
+s%@configure_input@%$configure_input%g
+s%@srcdir@%$srcdir%g
+s%@top_srcdir@%$top_srcdir%g
+s%@INSTALL@%$INSTALL%g
+" $ac_file_inputs | (eval "$ac_sed_cmds") > $ac_file
+fi; done
+rm -f conftest.s*
+
+# These sed commands are passed to sed as "A NAME B NAME C VALUE D", where
+# NAME is the cpp macro being defined and VALUE is the value it is being given.
+#
+# ac_d sets the value in "#define NAME VALUE" lines.
+ac_dA='s%^\([ 	]*\)#\([ 	]*define[ 	][ 	]*\)'
+ac_dB='\([ 	][ 	]*\)[^ 	]*%\1#\2'
+ac_dC='\3'
+ac_dD='%g'
+# ac_u turns "#undef NAME" with trailing blanks into "#define NAME VALUE".
+ac_uA='s%^\([ 	]*\)#\([ 	]*\)undef\([ 	][ 	]*\)'
+ac_uB='\([ 	]\)%\1#\2define\3'
+ac_uC=' '
+ac_uD='\4%g'
+# ac_e turns "#undef NAME" without trailing blanks into "#define NAME VALUE".
+ac_eA='s%^\([ 	]*\)#\([ 	]*\)undef\([ 	][ 	]*\)'
+ac_eB='$%\1#\2define\3'
+ac_eC=' '
+ac_eD='%g'
+
+if test "${CONFIG_HEADERS+set}" != set; then
+EOF
+cat >> $CONFIG_STATUS <<EOF
+  CONFIG_HEADERS="config.h"
+EOF
+cat >> $CONFIG_STATUS <<\EOF
+fi
+for ac_file in .. $CONFIG_HEADERS; do if test "x$ac_file" != x..; then
+  # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
+  case "$ac_file" in
+  *:*) ac_file_in=`echo "$ac_file"|sed 's%[^:]*:%%'`
+       ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
+  *) ac_file_in="${ac_file}.in" ;;
+  esac
+
+  echo creating $ac_file
+
+  rm -f conftest.frag conftest.in conftest.out
+  ac_file_inputs=`echo $ac_file_in|sed -e "s%^%$ac_given_srcdir/%" -e "s%:% $ac_given_srcdir/%g"`
+  cat $ac_file_inputs > conftest.in
+
+EOF
+
+# Transform confdefs.h into a sed script conftest.vals that substitutes
+# the proper values into config.h.in to produce config.h.  And first:
+# Protect against being on the right side of a sed subst in config.status.
+# Protect against being in an unquoted here document in config.status.
+rm -f conftest.vals
+cat > conftest.hdr <<\EOF
+s/[\\&%]/\\&/g
+s%[\\$`]%\\&%g
+s%#define \([A-Za-z_][A-Za-z0-9_]*\) *\(.*\)%${ac_dA}\1${ac_dB}\1${ac_dC}\2${ac_dD}%gp
+s%ac_d%ac_u%gp
+s%ac_u%ac_e%gp
+EOF
+sed -n -f conftest.hdr confdefs.h > conftest.vals
+rm -f conftest.hdr
+
+# This sed command replaces #undef with comments.  This is necessary, for
+# example, in the case of _POSIX_SOURCE, which is predefined and required
+# on some systems where configure will not decide to define it.
+cat >> conftest.vals <<\EOF
+s%^[ 	]*#[ 	]*undef[ 	][ 	]*[a-zA-Z_][a-zA-Z_0-9]*%/* & */%
+EOF
+
+# Break up conftest.vals because some shells have a limit on
+# the size of here documents, and old seds have small limits too.
+
+rm -f conftest.tail
+while :
+do
+  ac_lines=`grep -c . conftest.vals`
+  # grep -c gives empty output for an empty file on some AIX systems.
+  if test -z "$ac_lines" || test "$ac_lines" -eq 0; then break; fi
+  # Write a limited-size here document to conftest.frag.
+  echo '  cat > conftest.frag <<CEOF' >> $CONFIG_STATUS
+  sed ${ac_max_here_lines}q conftest.vals >> $CONFIG_STATUS
+  echo 'CEOF
+  sed -f conftest.frag conftest.in > conftest.out
+  rm -f conftest.in
+  mv conftest.out conftest.in
+' >> $CONFIG_STATUS
+  sed 1,${ac_max_here_lines}d conftest.vals > conftest.tail
+  rm -f conftest.vals
+  mv conftest.tail conftest.vals
+done
+rm -f conftest.vals
+
+cat >> $CONFIG_STATUS <<\EOF
+  rm -f conftest.frag conftest.h
+  echo "/* $ac_file.  Generated automatically by configure.  */" > conftest.h
+  cat conftest.in >> conftest.h
+  rm -f conftest.in
+  if cmp -s $ac_file conftest.h 2>/dev/null; then
+    echo "$ac_file is unchanged"
+    rm -f conftest.h
+  else
+    # Remove last slash and all that follows it.  Not all systems have dirname.
+      ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
+      if test "$ac_dir" != "$ac_file" && test "$ac_dir" != .; then
+      # The file is in a subdirectory.
+      test ! -d "$ac_dir" && mkdir "$ac_dir"
+    fi
+    rm -f $ac_file
+    mv conftest.h $ac_file
+  fi
+fi; done
+
+EOF
+cat >> $CONFIG_STATUS <<EOF
+
+EOF
+cat >> $CONFIG_STATUS <<\EOF
+
+exit 0
+EOF
+chmod +x $CONFIG_STATUS
+rm -fr confdefs* $ac_clean_files
+test "$no_create" = yes || ${CONFIG_SHELL-/bin/sh} $CONFIG_STATUS || exit 1
+

--- zisofs_tools/configure.in	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/configure.in	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,42 @@
+dnl
+dnl autoconf input file to generate MCONFIG
+dnl
+
+AC_INIT(MCONFIG.in)
+AC_PREFIX_DEFAULT(/usr)
+
+AC_PROG_CC
+AC_C_CONST
+AC_C_INLINE
+
+PA_ADD_CFLAGS(-Wall)
+PA_ADD_CFLAGS(-W)
+PA_ADD_CFLAGS(-Wpointer-arith)
+PA_ADD_CFLAGS(-Wbad-function-cast)
+PA_ADD_CFLAGS(-Wcast-equal)
+PA_ADD_CFLAGS(-Wstrict-prototypes)
+PA_ADD_CFLAGS(-Wmissing-prototypes)
+PA_ADD_CFLAGS(-Wmissing-declarations)
+PA_ADD_CFLAGS(-Wnested-externs)
+PA_ADD_CFLAGS(-Winline)
+PA_ADD_CFLAGS(-Wshadow)
+PA_ADD_CFLAGS(-Wcast-align)
+PA_ADD_CFLAGS(-pipe)
+
+AC_CHECK_HEADERS(sysexits.h)
+AC_CHECK_HEADERS(getopt.h)
+
+AC_CHECK_TYPE(off_t, signed long)
+AC_CHECK_TYPE(size_t, unsigned long)
+AC_CHECK_TYPE(ssize_t, signed long)
+
+AC_CHECK_FUNCS(lchown)
+
+AC_SEARCH_LIBS(compress2, z, , [AC_MSG_ERROR(zlib not found, cannot continue)])
+AC_SEARCH_LIBS(getopt_long, [getopt getopt_long], AC_DEFINE(HAVE_GETOPT_LONG))
+
+AC_PROG_RANLIB
+AC_PROG_INSTALL
+
+AC_CONFIG_HEADER(config.h)
+AC_OUTPUT(MCONFIG)

--- zisofs_tools/hash.c	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/hash.c	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,68 @@
+#ident "$Id: hash.c,v 1.1 2001/07/27 14:37:07 hpa Exp $"
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+/*
+ * hash.c
+ *
+ * Hash table used to find hard-linked files
+ */
+
+#include <stdlib.h>
+#include "mkzftree.h"
+
+#define HASH_BUCKETS 	  2683
+
+struct file_hash {
+  struct file_hash *next;
+  struct stat st;
+  const char *outfile_name;
+};
+
+static struct file_hash *hashp[HASH_BUCKETS];
+
+const char *hash_find_file(struct stat *st)
+{
+  int bucket = (st->st_ino + st->st_dev) % HASH_BUCKETS;
+  struct file_hash *hp;
+
+  for ( hp = hashp[bucket] ; hp ; hp = hp->next ) {
+    if ( hp->st.st_ino   == st->st_ino &&
+	 hp->st.st_dev   == st->st_dev &&
+	 hp->st.st_mode  == st->st_mode &&
+	 hp->st.st_nlink == st->st_nlink &&
+	 hp->st.st_uid   == st->st_uid &&
+	 hp->st.st_gid   == st->st_gid &&
+	 hp->st.st_size  == st->st_size &&
+	 hp->st.st_mtime == st->st_mtime ) {
+      /* Good enough, it's the same file */
+      return hp->outfile_name;
+    }
+  }
+  return NULL;			/* No match */
+}
+
+/* Note: the stat structure is the input file; the name
+   is the output file to link to */
+void hash_insert_file(struct stat *st, const char *outfile)
+{
+  int bucket = (st->st_ino + st->st_dev) % HASH_BUCKETS;
+  struct file_hash *hp = xmalloc(sizeof(struct file_hash));
+
+  hp->next         = hashp[bucket];
+  memcpy(&hp->st, st, sizeof(struct stat));
+  hp->outfile_name = xstrdup(outfile);
+
+  hashp[bucket]    = hp;
+}
+
+

--- zisofs_tools/install-sh	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/install-sh	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,238 @@
+#! /bin/sh
+#
+# install - install a program, script, or datafile
+# This comes from X11R5.
+#
+# Calling this script install-sh is preferred over install.sh, to prevent
+# `make' implicit rules from creating a file called install from it
+# when there is no Makefile.
+#
+# This script is compatible with the BSD install script, but was written
+# from scratch.
+#
+
+
+# set DOITPROG to echo to test this script
+
+# Don't use :- since 4.3BSD and earlier shells don't like it.
+doit="${DOITPROG-}"
+
+
+# put in absolute paths if you don't have them in your path; or use env. vars.
+
+mvprog="${MVPROG-mv}"
+cpprog="${CPPROG-cp}"
+chmodprog="${CHMODPROG-chmod}"
+chownprog="${CHOWNPROG-chown}"
+chgrpprog="${CHGRPPROG-chgrp}"
+stripprog="${STRIPPROG-strip}"
+rmprog="${RMPROG-rm}"
+mkdirprog="${MKDIRPROG-mkdir}"
+
+tranformbasename=""
+transform_arg=""
+instcmd="$mvprog"
+chmodcmd="$chmodprog 0755"
+chowncmd=""
+chgrpcmd=""
+stripcmd=""
+rmcmd="$rmprog -f"
+mvcmd="$mvprog"
+src=""
+dst=""
+dir_arg=""
+
+while [ x"$1" != x ]; do
+    case $1 in
+	-c) instcmd="$cpprog"
+	    shift
+	    continue;;
+
+	-d) dir_arg=true
+	    shift
+	    continue;;
+
+	-m) chmodcmd="$chmodprog $2"
+	    shift
+	    shift
+	    continue;;
+
+	-o) chowncmd="$chownprog $2"
+	    shift
+	    shift
+	    continue;;
+
+	-g) chgrpcmd="$chgrpprog $2"
+	    shift
+	    shift
+	    continue;;
+
+	-s) stripcmd="$stripprog"
+	    shift
+	    continue;;
+
+	-t=*) transformarg=`echo $1 | sed 's/-t=//'`
+	    shift
+	    continue;;
+
+	-b=*) transformbasename=`echo $1 | sed 's/-b=//'`
+	    shift
+	    continue;;
+
+	*)  if [ x"$src" = x ]
+	    then
+		src=$1
+	    else
+		# this colon is to work around a 386BSD /bin/sh bug
+		:
+		dst=$1
+	    fi
+	    shift
+	    continue;;
+    esac
+done
+
+if [ x"$src" = x ]
+then
+	echo "install:	no input file specified"
+	exit 1
+else
+	true
+fi
+
+if [ x"$dir_arg" != x ]; then
+	dst=$src
+	src=""
+	
+	if [ -d $dst ]; then
+		instcmd=:
+	else
+		instcmd=mkdir
+	fi
+else
+
+# Waiting for this to be detected by the "$instcmd $src $dsttmp" command
+# might cause directories to be created, which would be especially bad 
+# if $src (and thus $dsttmp) contains '*'.
+
+	if [ -f $src -o -d $src ]
+	then
+		true
+	else
+		echo "install:  $src does not exist"
+		exit 1
+	fi
+	
+	if [ x"$dst" = x ]
+	then
+		echo "install:	no destination specified"
+		exit 1
+	else
+		true
+	fi
+
+# If destination is a directory, append the input filename; if your system
+# does not like double slashes in filenames, you may need to add some logic
+
+	if [ -d $dst ]
+	then
+		dst="$dst"/`basename $src`
+	else
+		true
+	fi
+fi
+
+## this sed command emulates the dirname command
+dstdir=`echo $dst | sed -e 's,[^/]*$,,;s,/$,,;s,^$,.,'`
+
+# Make sure that the destination directory exists.
+#  this part is taken from Noah Friedman's mkinstalldirs script
+
+# Skip lots of stat calls in the usual case.
+if [ ! -d "$dstdir" ]; then
+defaultIFS='	
+'
+IFS="${IFS-${defaultIFS}}"
+
+oIFS="${IFS}"
+# Some sh's can't handle IFS=/ for some reason.
+IFS='%'
+set - `echo ${dstdir} | sed -e 's@/@%@g' -e 's@^%@/@'`
+IFS="${oIFS}"
+
+pathcomp=''
+
+while [ $# -ne 0 ] ; do
+	pathcomp="${pathcomp}${1}"
+	shift
+
+	if [ ! -d "${pathcomp}" ] ;
+        then
+		$mkdirprog "${pathcomp}"
+	else
+		true
+	fi
+
+	pathcomp="${pathcomp}/"
+done
+fi
+
+if [ x"$dir_arg" != x ]
+then
+	$doit $instcmd $dst &&
+
+	if [ x"$chowncmd" != x ]; then $doit $chowncmd $dst; else true ; fi &&
+	if [ x"$chgrpcmd" != x ]; then $doit $chgrpcmd $dst; else true ; fi &&
+	if [ x"$stripcmd" != x ]; then $doit $stripcmd $dst; else true ; fi &&
+	if [ x"$chmodcmd" != x ]; then $doit $chmodcmd $dst; else true ; fi
+else
+
+# If we're going to rename the final executable, determine the name now.
+
+	if [ x"$transformarg" = x ] 
+	then
+		dstfile=`basename $dst`
+	else
+		dstfile=`basename $dst $transformbasename | 
+			sed $transformarg`$transformbasename
+	fi
+
+# don't allow the sed command to completely eliminate the filename
+
+	if [ x"$dstfile" = x ] 
+	then
+		dstfile=`basename $dst`
+	else
+		true
+	fi
+
+# Make a temp file name in the proper directory.
+
+	dsttmp=$dstdir/#inst.$$#
+
+# Move or copy the file name to the temp name
+
+	$doit $instcmd $src $dsttmp &&
+
+	trap "rm -f ${dsttmp}" 0 &&
+
+# and set any options; do chmod last to preserve setuid bits
+
+# If any of these fail, we abort the whole thing.  If we want to
+# ignore errors from any of these, just make sure not to ignore
+# errors from the above "$doit $instcmd $src $dsttmp" command.
+
+	if [ x"$chowncmd" != x ]; then $doit $chowncmd $dsttmp; else true;fi &&
+	if [ x"$chgrpcmd" != x ]; then $doit $chgrpcmd $dsttmp; else true;fi &&
+	if [ x"$stripcmd" != x ]; then $doit $stripcmd $dsttmp; else true;fi &&
+	if [ x"$chmodcmd" != x ]; then $doit $chmodcmd $dsttmp; else true;fi &&
+
+# Now rename the file to the real destination.
+
+	$doit $rmcmd -f $dstdir/$dstfile &&
+	$doit $mvcmd $dsttmp $dstdir/$dstfile 
+
+fi &&
+
+
+exit 0

--- zisofs_tools/iso9660.c	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/iso9660.c	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,111 @@
+/* $Id: iso9660.c,v 1.1 2001/07/27 14:37:08 hpa Exp $ */
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+#include "iso9660.h"
+
+/* zisofs magic */
+
+const unsigned char zisofs_magic[8] = {
+  0x37, 0xE4, 0x53, 0x96, 0xC9, 0xDB, 0xD6, 0x07
+};
+
+/* iso9660 integer formats */
+
+void
+set_721(void *pnt, unsigned int i)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  p[0] = i & 0xff;
+  p[1] = (i >> 8) & 0xff;
+}
+
+unsigned int
+get_721(void *pnt)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  return ((unsigned int)p[0]) + ((unsigned int)p[1] << 8);
+}
+
+void
+set_722(void *pnt, unsigned int i)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  p[0] = (i >> 8) & 0xff;
+  p[1] = i & 0xff;
+}
+
+unsigned int
+get_722(void *pnt)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  return ((unsigned int)p[0] << 8) + ((unsigned int)p[1]);
+}
+
+void
+set_723(void *pnt, unsigned int i)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  p[3] = p[0] = i & 0xff;
+  p[2] = p[1] = (i >> 8) & 0xff;
+}
+
+#define get_723(x) get_721(x)
+
+void
+set_731(void *pnt, unsigned int i)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  p[0] = i & 0xff;
+  p[1] = (i >> 8) & 0xff;
+  p[2] = (i >> 16) & 0xff;
+  p[3] = (i >> 24) & 0xff;
+}
+
+unsigned int
+get_731(void *pnt)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  return ((unsigned int)p[0]) + ((unsigned int)p[1] << 8) +
+    ((unsigned int)p[2] << 16) + ((unsigned int)p[3] << 24);
+}
+
+void
+set_732(void *pnt, unsigned int i)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  p[3] = i & 0xff;
+  p[2] = (i >> 8) & 0xff;
+  p[1] = (i >> 16) & 0xff;
+  p[0] = (i >> 24) & 0xff;
+}
+
+unsigned int
+get_732(void *pnt)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  return ((unsigned int)p[0] << 24) + ((unsigned int)p[1] << 16) +
+    ((unsigned int)p[2] << 8) + ((unsigned int)p[3]);
+}
+
+void
+set_733(void *pnt, unsigned int i)
+{
+  unsigned char *p = (unsigned char *)pnt;
+  p[7] = p[0] = i & 0xff;
+  p[6] = p[1] = (i >> 8) & 0xff;
+  p[5] = p[2] = (i >> 16) & 0xff;
+  p[4] = p[3] = (i >> 24) & 0xff;
+}
+
+#define get_733(x) get_731(x)
+

--- zisofs_tools/iso9660.h	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/iso9660.h	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,45 @@
+#ident "$Id: iso9660.h,v 1.3 2001/07/27 19:49:08 hpa Exp $"
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+/* zisofs definitions */
+
+#ifndef CBLOCK_SIZE_LG2
+#define CBLOCK_SIZE_LG2	15	/* Compressed block size */
+#endif
+#define CBLOCK_SIZE	(1 << CBLOCK_SIZE_LG2)
+
+/* Compressed file magic */
+extern const unsigned char zisofs_magic[8];
+
+/* VERY VERY VERY IMPORTANT: Must be a multiple of 4 bytes */
+struct compressed_file_header {
+  char magic[8];
+  char uncompressed_len[4];
+  unsigned char header_size;
+  unsigned char block_size;
+  char reserved[2];		/* Reserved for future use, MBZ */
+};
+
+/* iso9660 integer formats */
+void set_721(void *, unsigned int);
+unsigned int get_721(void *);
+void set_722(void *, unsigned int);
+unsigned int get_722(void *);
+void set_723(void *, unsigned int);
+void set_731(void *, unsigned int);
+unsigned int get_731(void *);
+void set_732(void *, unsigned int);
+unsigned int get_732(void *);
+void set_733(void *, unsigned int);
+#define get_723(x) get_721(x)
+#define get_733(x) get_731(x)

--- zisofs_tools/Makefile	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/Makefile	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,24 @@
+#ident %W% %E% %Q%
+###########################################################################
+# Makefile for zisofs_tools in cdrtools package for debian
+###########################################################################
+SRCROOT=	../
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+INSDIR=		bin
+TARGET=		mkzftree
+CPPOPTS +=	-DUSE_LARGEFILES
+
+CFILES = 	mkzftree.c walk.c workers.c util.c hash.c iso9660.c \
+	   		compress.c uncompress.c
+HFILES =    config.h iso9660.h mkzftree.h version.h
+LIBS=		-lz
+XMK_FILE=	Makefile.man
+
+GNU_CC_WARNINGS = -Wall -W -Wpointer-arith -Wbad-function-cast -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -Winline -Wshadow -Wcast-align
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.cmd
+###########################################################################

--- zisofs_tools/Makefile.man	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/Makefile.man	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,30 @@
+#ident @(#)Makefile.man	1.3 00/11/19 
+###########################################################################
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; see the file COPYING.  If not, write to
+# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+###########################################################################
+SRCROOT=	..
+RULESDIR=	RULES
+include		$(SRCROOT)/$(RULESDIR)/rules.top
+###########################################################################
+
+MANDIR=		man
+TARGETMAN=	mkzftree
+MANSECT=	$(MANSECT_ADMIN)
+MANSUFFIX=	$(MANSUFF_ADMIN)
+MANFILE=	mkzftree.8
+
+###########################################################################
+include		$(SRCROOT)/$(RULESDIR)/rules.man
+###########################################################################

--- zisofs_tools/MCONFIG.in	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/MCONFIG.in	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,38 @@
+# Prefixes
+prefix      = @prefix@
+exec_prefix = @exec_prefix@
+
+# Directory for user binaries
+bindir  = @bindir@
+
+# Man page tree
+mandir  = @mandir@
+
+# System binaries
+sbindir = @sbindir@
+
+# Install into chroot area
+# Useful when making rpms and similar
+INSTALLROOT = 
+
+# Install program
+INSTALL         = @INSTALL@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_DATA    = @INSTALL_DATA@
+
+# Compiler and compiler flags
+CC      = @CC@
+CFLAGS  = @CFLAGS@
+
+# Link flags
+LDFLAGS = @LDFLAGS@
+
+# Libraries
+LIBS    = @LIBS@
+
+# Additional library we need to build
+LIBOBJS	= @LIBOBJS@
+
+# ar and ranlib (for making libraries)
+AR	= ar cq
+RANLIB	= @RANLIB@

--- zisofs_tools/mkzftree.8	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/mkzftree.8	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,120 @@
+.\" $Id: mkzftree.1,v 1.12 2002/11/07 03:58:18 hpa Exp $
+.\" -----------------------------------------------------------------------
+.\"   
+.\"   Copyright 2001 H. Peter Anvin - All Rights Reserved
+.\"
+.\"   This program is free software; you can redistribute it and/or modify
+.\"   it under the terms of the GNU General Public License as published by
+.\"   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+.\"   USA; either version 2 of the License, or (at your option) any later
+.\"   version; incorporated herein by reference.
+.\"
+.\" -----------------------------------------------------------------------
+.TH MKZFTREE "1" "30 July 2001" "zisofs-tools" "H. Peter Anvin"
+.SH NAME
+mkzftree \- Create a zisofs/RockRidge compressed file tree
+.SH SYNOPSIS
+.B mkzftree
+[\fIOPTIONS\fR]... \fIINPUT\fR \fIOUTPUT\fR
+.SH DESCRIPTION
+.PP
+Takes an input file tree (\fIINPUT\fR) and create a corresponding
+compressed file tree (\fIOUTPUT\fR) that can be used with an
+appropriately patched
+.BR mkisofs (8)
+to create a transparent-compression ISO 9660/Rock Ridge filesystem using
+the "ZF" compression records.
+.RP
+.TP
+\fB\-f\fP, \fB\-\-force\fP
+Always compress all files, even if they get larger when compressed.
+.TP
+\fB\-z\fP \fIlevel\fP, \fB\-\-level\fP \fIlevel\fP
+Select compression level (1-9, default is 9).  Lower compression
+levels are faster, but typically result in larger output.
+.TP
+\fB\-u\fP, \fB\-\-uncompress\fP
+Uncompress an already compressed tree.  This can be used to read a
+compressed filesystem on a system which cannot read them natively.
+.TP
+\fB\-p\fP \fIparallelism\fP, \fB\-\-parallelism\fP \fIparallelism\fP
+Compress in parallel.  The
+.I parallelism
+value indicates how many compression threads are allowed to run.
+.TP
+\fB\-x\fP, \fB\-\-one-filesystem\fP
+Do not cross filesystem boundaries, but create directory stubs at
+mount points.
+.TP
+\fB\-X\fP, \fB\-\-strict-one-filesystem\fP
+Do not cross filesystem boundaries, and do not create directory stubs
+at mount points.
+.TP
+\fB\-C\fP \fIpath\fP, \fB\-\-crib-path\fP \fIpath\fP
+Steal ("crib") files from another directory if it looks (based on
+name, size, type and modification time) like they match entries in the
+new filesystem.  The "crib tree" is usually the compressed version of
+an older version of the same workload; this thus allows for
+"incremental rebuilds" of a compressed filesystem tree.  The files are
+hardlinked from the crib tree to the output tree, so if it is
+desirable to keep the link count correct the crib path should be
+deleted before running \fBmkisofs\fP.  The crib tree must be on the
+same filesystem as the output tree.
+.TP
+\fB\-l\fP, \fB\-\-local\fP
+Do not recurse into subdirectories, but create the directories
+themselves.
+.TP
+\fB\-L\fP, \fB\-\-strict-local\fP
+Do not recurse into subdirectories, and do not create directories.
+.TP
+\fB\-F\fP, \fB\-\-file\fP
+Indicates that \fIINPUT\fP may not necessarily be a directory; this
+allows operation on a single file.  Note especially that if \fI\-F\fP
+is specified, and \fIINPUT\fP is a symlink, the symlink itself will be
+copied rather than whatever it happens to point to.
+.TP
+\fB\-s\fP, \fB\-\-sloppy\fP
+Treat file modes, times and ownership data as less than precious
+information and don't abort if they cannot be set.  This may be useful
+if running
+.B mkisofs
+on an input tree you do not own.
+.TP
+\fB\-v\fP, \fB\-\-verbose\fP
+Increase the program verbosity.
+.TP
+\fB\-V\fP \fIvalue\fP, \fB\-\-verbosity\fP \fIvalue\fP
+Set the program verbosity to
+.IR value .
+.TP
+\fB\-q\fP, \fB\-\-quiet\fP
+Issue no messages whatsoever, including error messages.  This is the same
+as specifying
+.IR "\-V\ 0" .
+.TP
+\fB\-h\fP, \fB\-\-help\fP
+Display a brief help message.
+.TP
+\fB\-w\fP, \fB\-\-version\fP
+Display the release version.
+.SH BUGS
+Long options (beginning with \fI\-\-\fP) may not work on all systems.
+See the message printed out by \fImkzftree\ \-h\fP to see if this
+applies to your system.
+.PP
+Inode change times (ctimes) are not copied.  This is a system
+limitation and applies to all file copy programs.
+.PP
+If using the parallel option (\fI\-p\fP) the access times (atimes) on
+directories may or may not be copied.  If it is important that the
+atimes on directories are copied exactly, avoid using \fI\-p\fP.
+.SH AUTHOR
+Written by H. Peter Anvin <hpa@zytor.com>.
+.SH COPYRIGHT
+Copyright \(co 2001-2002 H. Peter Anvin.
+.br
+This is free software; see the source for copying conditions.  There is NO
+warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+.SH "SEE ALSO"
+.BR mkisofs (8)

--- zisofs_tools/mkzftree.c	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/mkzftree.c	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,284 @@
+/* $Id: mkzftree.c,v 1.16 2002/11/07 04:10:06 hpa Exp $ */
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+/*
+ * mkzffile.c
+ *
+ *	- Generate block-compression of files for use with
+ *	  the "ZF" extension to the iso9660/RockRidge filesystem.
+ *
+ *	  The file compression technique used is the "deflate"
+ *	  algorithm used by the zlib library; each block must have a
+ *	  valid (12-byte) zlib header.  In addition, the file itself
+ *	  has the following structure:
+ *
+ *	  Byte offset	iso9660 type	Contents
+ *	    0		(8 bytes)	Magic number (37 E4 53 96 C9 DB D6 07)
+ *	    8		7.3.1		Uncompressed file size
+ *	   12		7.1.1		header_size >> 2 (currently 4)
+ *	   13		7.1.1		log2(block_size)
+ *	   14		(2 bytes)	Reserved, must be zero
+ *
+ * The header may get expanded in the future, at which point the
+ * header size field will be used to increase the space for the
+ * header.
+ *
+ * All implementations are required to support a block_size of 32K
+ * (byte 13 == 15).
+ *
+ * Note that bytes 12 and 13 and the uncompressed length are also
+ * present in the ZF record; THE TWO MUST BOTH BE CONSISTENT AND
+ * CORRECT.
+ *
+ * Given the uncompressed size, block_size, and header_size:
+ *
+ *     Nblocks := ceil(size/block_size)
+ *
+ * After the header follow (nblock+1) 32-bit pointers, recorded as
+ * iso9660 7.3.1 (littleendian); each indicate the byte offset (from
+ * the start of the file) to one block and the first byte beyond the
+ * end of the previous block; the first pointer thus point to the
+ * start of the data area and the last pointer to the first byte
+ * beyond it:
+ *
+ *     block_no := floor(byte_offset/block_size)
+ *
+ *     block_start := read_pointer_731( (header_size+block_no)*4 )
+ *     block_end   := read_pointer_731( (header_size+block_no+1)*4 )
+ *
+ * The block data is compressed according to "zlib".
+ */
+
+#include <errno.h>
+#include <stdlib.h>
+#include <string.h>
+#include <stdio.h>
+#include <unistd.h>
+#include <limits.h>
+#include <utime.h>
+#include <sys/stat.h>
+#include <sys/types.h>
+
+#include "mkzftree.h"
+#include "version.h"
+
+#ifdef HAVE_GETOPT_H
+#include <getopt.h>
+#endif
+
+/* Command line options */
+struct cmdline_options opt = {
+  0,				/* Force compression */
+  9,				/* Compression level */
+  0,				/* Parallelism (0 = strictly serial) */
+  0,				/* One filesystem only */
+  0,				/* One directory only */
+  1,				/* Create stub directories */
+  0,				/* Root may be a file */
+  0,				/* Be paranoid about metadata */
+  default_verbosity,		/* Default verbosity */
+  block_compress_file		/* Default transformation function */
+};
+
+/* Program name */
+const char *program;
+
+/* Long options */
+#define OPTSTRING "fz:up:xXC:lLFvqV:hw"
+#ifdef HAVE_GETOPT_LONG
+const struct option long_options[] = {
+  { "force",	             0,  0,  'f' },
+  { "level",                 1,  0,  'z' },
+  { "uncompress",            0,  0,  'u' },
+  { "parallelism",           1,  0,  'p' },
+  { "one-filesystem",        0,  0,  'x' },
+  { "strict-one-filesystem", 0,  0,  'X' },
+  { "crib-tree",             1,  0,  'C' },
+  { "local",                 0,  0,  'l' },
+  { "strict-local",          0,  0,  'L' },
+  { "file",                  0,  0,  'F' },
+  { "verbose",               0,  0,  'v' },
+  { "quiet",                 0,  0,  'q' },
+  { "verbosity",             1,  0,  'V' },
+  { "help",                  0,  0,  'h' },
+  { "version",               0,  0,  'w' },
+  { 0, 0, 0, 0 }
+};
+#define LO(X) X
+#else
+#define getopt_long(C,V,O,L,I) getopt(C,V,O)
+#define LO(X)
+#endif
+  
+static void usage(enum verbosity level, int err)
+{
+  message(level,
+	  "zisofs-tools " ZISOFS_TOOLS_VERSION "\n"
+	  "Usage: %s [options] intree outtree\n"
+	  LO("  --force                ")"  -f    Always compress, even if result is larger\n"
+	  LO("  --level #              ")"  -z #  Set compression level (1-9)\n"
+	  LO("  --uncompress           ")"  -u    Uncompress an already compressed tree\n"
+	  LO("  --parallelism #        ")"  -p #  Process up to # files in parallel\n"
+	  LO("  --one-filesystem       ")"  -x    Do not cross filesystem boundaries\n"
+	  LO("  --strict-one-filesystem")"  -X    Same as -x, but don't create stubs dirs\n"
+	  LO("  --crib-tree            ")"  -C    Steal \"crib\" files from an old tree\n"
+	  LO("  --local                ")"  -l    Do not recurse into subdirectoires\n"
+	  LO("  --strict-local         ")"  -L    Same as -l, but don't create stubs dirs\n"
+	  LO("  --file                 ")"  -F    Operate possibly on a single file\n"
+	  LO("  --sloppy               ")"  -s    Don't abort if metadata cannot be set\n"
+	  LO("  --verbose              ")"  -v    Increase message verbosity\n"
+	  LO("  --verbosity #          ")"  -V #  Set message verbosity to # (default = %d)\n"
+	  LO("  --quiet                ")"  -q    No messages, not even errors (-V 0)\n"
+	  LO("  --help                 ")"  -h    Display this message\n"
+	  LO("  --version              ")"  -w    Display the program version\n"
+	  ,program, (int)default_verbosity);
+  exit(err);
+}
+
+static int opt_atoi(const char *str)
+{
+  char *endptr;
+  long out;
+
+  out = strtol(str, &endptr, 10);
+  if ( *endptr )
+    usage(vl_error, EX_USAGE);
+
+  return (int)out;
+}
+
+
+int main(int argc, char *argv[])
+{
+  const char *in, *out, *crib = NULL;
+  struct stat st;
+  struct utimbuf ut;
+  int optch, err;
+
+  program = argv[0];
+
+  while ( (optch = getopt_long(argc, argv, OPTSTRING, long_options, NULL))
+	  != EOF ) {
+    switch(optch) {
+    case 'f':
+      opt.force = 1;		/* Always compress */
+      break;
+    case 'z':
+      opt.level = opt_atoi(optarg);
+      if ( opt.level < 1 || opt.level > 9 ) {
+	message(vl_error, "%s: invalid compression level: %d\n",
+		program, optarg);
+	exit(EX_USAGE);
+      }
+      break;
+    case 'v':
+      opt.verbosity++;
+      break;
+    case 'V':
+      opt.verbosity = opt_atoi(optarg);
+      break;
+    case 'q':
+      opt.verbosity = vl_quiet;
+      break;
+    case 'u':
+      opt.munger = block_uncompress_file;
+      break;
+    case 'C':
+      crib = optarg;
+      break;
+    case 'p':
+      opt.parallel = opt_atoi(optarg);
+      break;
+    case 'x':
+      opt.onefs = 1;  opt.do_mkdir = 1;
+      break;
+    case 'l':
+      opt.onedir = 1; opt.do_mkdir = 1;
+      break;
+    case 'X':
+      opt.onefs = 1;  opt.do_mkdir = 0;
+      break;
+    case 'L':
+      opt.onedir = 1; opt.do_mkdir = 0;
+      break;
+    case 'F':
+      opt.file_root = 1;
+      break;
+    case 's':
+      opt.sloppy = 1;
+      break;
+    case 'h':
+      usage(vl_quiet, 0);
+      break;
+    case 'w':
+      message(vl_quiet, "zisofs-tools " ZISOFS_TOOLS_VERSION "\n");
+      exit(0);
+    default:
+      usage(vl_error, EX_USAGE);
+      break;
+    }
+  }
+
+  if ( (argc-optind) != 2 )
+    usage(vl_error, EX_USAGE);
+
+  in  = argv[optind];		/* Input tree */
+  out = argv[optind+1];		/* Output tree */
+
+  umask(077);
+
+  if ( opt.file_root ) {
+    if ( lstat(in, &st) ) {
+      message(vl_error, "%s: %s: %s\n", program, in, strerror(errno));
+      exit(EX_NOINPUT);
+    }
+
+    err = munge_entry(in, out, crib, NULL);
+  } else {
+    /* Special case: we use stat() for the root, not lstat() */
+    if ( stat(in, &st) ) {
+      message(vl_error, "%s: %s: %s\n", program, in, strerror(errno));
+      exit(EX_NOINPUT);
+    }
+    if ( !S_ISDIR(st.st_mode) ) {
+      message(vl_error, "%s: %s: Not a directory\n", program, in);
+      exit(EX_DATAERR);
+    }
+    
+    err = munge_tree(in, out, crib);
+  }    
+
+  wait_for_all_workers();
+    
+  if ( err )
+    exit(err);
+
+  if ( !opt.file_root ) {
+    if ( chown(out, st.st_uid, st.st_gid) && !opt.sloppy ) {
+      message(vl_error, "%s: %s: %s", program, out, strerror(errno));
+      err = EX_CANTCREAT;
+    }
+    if ( chmod(out, st.st_mode) && !opt.sloppy && !err ) {
+      message(vl_error, "%s: %s: %s", program, out, strerror(errno));
+      err = EX_CANTCREAT;
+    }
+    ut.actime  = st.st_atime;
+    ut.modtime = st.st_mtime;
+    if ( utime(out, &ut) && !opt.sloppy && !err ) {
+      message(vl_error, "%s: %s: %s", program, out, strerror(errno));
+      err = EX_CANTCREAT;
+    }
+  }
+
+  return err;
+}

--- zisofs_tools/mkzftree.h	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/mkzftree.h	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,86 @@
+#ident "$Id: mkzftree.h,v 1.4 2002/11/07 03:58:18 hpa Exp $"
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+#include "config.h"
+#include <stddef.h>
+#include <stdlib.h>
+#include <stdio.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+
+#ifdef HAVE_SYSEXITS_H
+#include <sysexits.h>
+#else
+#define EX_USAGE	64	/* command line usage error */
+#define EX_DATAERR	65	/* data format error */
+#define EX_NOINPUT	66	/* cannot open input */
+#define EX_NOUSER	67	/* addressee unknown */
+#define EX_NOHOST	68	/* host name unknown */
+#define EX_UNAVAILABLE	69	/* service unavailable */
+#define EX_SOFTWARE	70	/* internal software error */
+#define EX_OSERR	71	/* system error (e.g., can't fork) */
+#define EX_OSFILE	72	/* critical OS file missing */
+#define EX_CANTCREAT	73	/* can't create (user) output file */
+#define EX_IOERR	74	/* input/output error */
+#define EX_TEMPFAIL	75	/* temp failure; user is invited to retry */
+#define EX_PROTOCOL	76	/* remote error in protocol */
+#define EX_NOPERM	77	/* permission denied */
+#define EX_CONFIG	78	/* configuration error */
+#endif
+
+/* File transformation functions */  
+typedef int (*munger_func)(FILE *, FILE *, off_t);
+int block_compress_file(FILE *, FILE *, off_t);
+int block_uncompress_file(FILE *, FILE *, off_t);
+
+/* mkzftree.c */
+extern const char *program;	/* Program name */
+enum verbosity {		/* Message verbosity */
+  vl_quiet,			/* No messages */
+  vl_error,			/* Error messages only */
+  vl_filename,			/* Display filenames */
+  vl_crib,			/* Cribbing files */
+};
+#define default_verbosity vl_error
+struct cmdline_options {
+  int force;			/* Always compress */
+  int level;			/* Compression level */
+  int parallel;			/* Parallelism (0 = strictly serial) */
+  int onefs;			/* One filesystem only */
+  int onedir;			/* One directory only */
+  int do_mkdir;			/* Create stub directories */
+  int file_root;		/* The root may be a file */
+  int sloppy;			/* Don't make sure metadata is set correctly */
+  enum verbosity verbosity;	/* Message verbosity */
+  munger_func munger;		/* Default action */
+};
+extern struct cmdline_options opt;
+
+/* walk.c */
+int munge_tree(const char *, const char *, const char *);
+int munge_entry(const char *, const char *, const char *, const struct stat *);
+
+/* workers.c */
+void wait_for_all_workers(void);
+int spawn_worker(void);
+void end_worker(int);
+
+/* util.c */
+void *xmalloc(size_t);
+char *xstrdup(const char *);
+void message(enum verbosity, const char *, ...);
+
+/* hash.c */
+const char *hash_find_file(struct stat *);
+void hash_insert_file(struct stat *, const char *);
+

--- zisofs_tools/MRULES	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/MRULES	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,22 @@
+# Standard compilation rules (don't use make builtins)
+
+.SUFFIXES: .c .cc .o .s .S .i
+
+.c.o:
+	$(CC) $(CFLAGS) -c $<
+
+.c.s:
+	$(CC) $(CFLAGS) -S -o $@ $<
+
+.c.i:
+	$(CC) $(CFLAGS) -E -o $@ $<
+
+.cc.o:
+	$(CXX) $(CXXFLAGS) -c $<
+
+.cc.s:
+	$(CXX) $(CXXFLAGS) -S -o $@ $<
+
+.cc.i:
+	$(CXX) $(CXXFLAGS) -E -o $@ $<
+

--- zisofs_tools/README.zisofs	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/README.zisofs	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,48 @@
+		    H. Peter Anvin <hpa@zytor.com>
+			   October 18, 2002
+
+
+User tools for zisofs:
+
+The user tools for zisofs come in two parts: a utility "mkzftree" and
+a modification to mkisofs, which is part of the cdrtools package.  The
+mkisofs change has been integrated in the cdrtools distribution as of
+cdrtools-1.11a20; a patch for cdrtools-1.11a09 which is also tested
+and working on cdrtools-1.10 is included with this package if you
+insist on running an older version.
+
+
+First create a directory tree containing compressed files:
+
+	mkzftree input_dir compressed_dir
+
+mkzftree will not overwrite an existing directory; you may want to "rm
+-rf" the directory tree if you are doing this from a script:
+
+Second, invoke the patched mkisofs with the -z option:
+
+	mkisofs -z -R [other options] -o compressed.iso compressed_dir
+
+IMPORTANT: you *must* enable RockRidge (-R or -r) since this is an
+extensions to the RockRidge specification.  Without RockRidge, -z will
+have no effect.
+
+Note that if there are files you do not want compressed (for example,
+files involved in booting, or README files you want to be readable
+under all circumstances) you can simply put them in a separate tree
+and not run mkzftree on that tree.
+
+mkzftree will not compress files that end up larger when compressed;
+if you want it to compress the files anyway, you can give the -f
+option to mkzftree.
+
+mkzftree also accepts a -u option (uncompress), which can be used to
+convert a compressed tree back to normal form.  This can be used to
+read a zisofs CD-ROM on a machine without zisofs kernel support.
+
+This version of mkzftree supports a -p option (parallelize.)
+Specifying -p and a parallelism (e.g. -p4) allows files (up to the
+number specified) to compress in parallel.  Depending on your setup
+and your data set size, this might speed things up if you are not
+completely I/O bound.  Use -p0 to completely disable parallel
+execution; this is the default.

--- zisofs_tools/uncompress.c	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/uncompress.c	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,133 @@
+/* $Id: uncompress.c,v 1.2 2001/07/27 19:49:08 hpa Exp $ */
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <zlib.h>
+#include "mkzftree.h"
+#include "iso9660.h"
+
+int block_uncompress_file(FILE *input, FILE *output, off_t size)
+{
+  struct compressed_file_header hdr;
+  char *inbuf, *outbuf;
+  int block_shift;
+  char *pointer_block, *pptr;
+  unsigned long nblocks;
+  unsigned long fullsize, block_size, block_size2;
+  size_t ptrblock_bytes;
+  unsigned long cstart, cend, csize;
+  uLong bytes;
+  int zerr;
+  int err = EX_SOFTWARE;
+
+  if ( (bytes = fread(&hdr, 1, sizeof hdr, input)) != sizeof hdr ) {
+    if ( bytes == (size_t)size ) {
+      /* Very short file; not compressed */
+      return ( fwrite(&hdr, 1, bytes, output) != bytes ) ? EX_CANTCREAT : 0;
+    } else {
+      return EX_IOERR;		/* Read error */
+    }
+  }
+
+  if ( memcmp(&hdr.magic, zisofs_magic, sizeof zisofs_magic) ) {
+    inbuf = xmalloc(CBLOCK_SIZE);
+    /* Not compressed */
+    memcpy(inbuf, &hdr, sizeof hdr);
+    bytes = sizeof hdr;
+    do {
+      if ( fwrite(inbuf, 1, bytes, output) != bytes )
+	return EX_CANTCREAT;
+    } while ( (bytes = fread(inbuf, 1, CBLOCK_SIZE, input)) > 0 );
+    free(inbuf);
+    return ferror(input) ? EX_IOERR : 0;
+  }
+
+  /* Now we know the file must be compressed.  Get the pointer table. */
+  if ( fseek(input, hdr.header_size << 2, SEEK_SET) == -1 )
+    return EX_IOERR;
+
+  fullsize    = get_731(hdr.uncompressed_len);
+  block_shift = hdr.block_size;
+  block_size  = 1UL << block_shift;
+  block_size2 = block_size << 1;
+  inbuf  = xmalloc(block_size2);
+  outbuf = xmalloc(block_size);
+
+  nblocks = (fullsize + block_size - 1) >> block_shift;
+
+  ptrblock_bytes = (nblocks+1) * 4;
+  pointer_block = xmalloc(ptrblock_bytes);
+
+  if ( (bytes = fread(pointer_block, 1, ptrblock_bytes, input)) != ptrblock_bytes ) {
+    err = EX_IOERR;
+    goto free_ptr_bail;
+  }
+  
+  pptr = pointer_block;
+  while ( fullsize ) {
+    cstart = get_731(pptr);
+    pptr += 4;
+    cend   = get_731(pptr);
+
+    csize = cend-cstart;
+
+    if ( csize == 0 ) {
+      memset(outbuf, 0, block_size);
+      bytes = block_size;
+    } else {
+      if ( csize > block_size2 ) {
+	err = EX_DATAERR;
+	goto free_ptr_bail;
+      }
+      
+      if ( fseek(input, cstart, SEEK_SET) == -1 ||
+	   (bytes = fread(inbuf, 1, csize, input)) != csize ) {
+	err = EX_IOERR;
+	goto free_ptr_bail;
+      }
+      
+      bytes = block_size;		/* Max output buffer size */
+      if ( (zerr = uncompress(outbuf, &bytes, inbuf, csize)) != Z_OK ) {
+	err = (zerr = Z_MEM_ERROR) ? EX_OSERR : EX_DATAERR;
+	goto free_ptr_bail;
+      }
+    }
+      
+    if ( ((fullsize > block_size) && (bytes != block_size))
+	 || ((fullsize <= block_size) && (bytes < fullsize)) ) {
+      err = EX_DATAERR;
+      goto free_ptr_bail;
+    }
+    
+    if ( bytes > fullsize )
+      bytes = fullsize;
+    
+    if ( fwrite(outbuf, 1, bytes, output) != bytes ) {
+      err = EX_CANTCREAT;
+      goto free_ptr_bail;
+    }
+
+    fullsize -= bytes;
+  }
+
+  err = 0;
+
+ free_ptr_bail:
+  free(pointer_block);
+  free(inbuf);
+  free(outbuf);
+  return err;
+}
+
+

--- zisofs_tools/util.c	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/util.c	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,55 @@
+/* $Id: util.c,v 1.2 2001/07/31 03:20:52 hpa Exp $ */
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+#include <stdio.h>
+#include <errno.h>
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include "mkzftree.h"
+
+/* Convenience functions */
+void *xmalloc(size_t size)
+{
+  void *p = malloc(size);
+
+  if ( !p ) {
+    perror(program);
+    exit(EX_OSERR);
+  }
+
+  return p;
+}
+
+char *xstrdup(const char *str)
+{
+  char *s = strdup(str);
+
+  if ( !s ) {
+    perror(program);
+    exit(EX_OSERR);
+  }
+  
+  return s;
+}
+
+void message(enum verbosity level, const char *format, ...)
+{
+  va_list ap;
+
+  va_start(ap, format);
+  if ( opt.verbosity >= level )
+    vfprintf(stderr, format, ap);
+  va_end(ap);
+}
+

--- zisofs_tools/version	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/version	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1 @@
+1.0.4

--- zisofs_tools/version.h	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/version.h	2002-12-27 21:00:49.000000000 +0100
@@ -0,0 +1 @@
+#define ZISOFS_TOOLS_VERSION "1.0.4"

--- zisofs_tools/walk.c	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/walk.c	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,321 @@
+#ident "$Id: walk.c,v 1.5 2002/11/07 03:58:18 hpa Exp $"
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001-2002 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+/*
+ * walk.c
+ *
+ * Functions to walk the file tree
+ */
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <limits.h>
+#include <utime.h>
+#include <string.h>
+#include <errno.h>
+#include <dirent.h>
+#include <unistd.h>
+#include <sys/stat.h>
+#include <sys/types.h>
+#include "mkzftree.h"
+#include "iso9660.h"
+
+static int munge_file(const char *inpath, const char *outpath,
+		      const char *cribpath, struct stat *st)
+{
+  FILE *in, *out;
+  int err = 0;
+  struct utimbuf ut;
+
+  if ( cribpath ) {
+    struct stat cst;
+    struct compressed_file_header cfh;
+
+    /* Compare as much as we realistically can */
+    if ( !stat(cribpath, &cst) &&
+	 st->st_mode == cst.st_mode &&
+	 st->st_uid == cst.st_uid &&
+	 st->st_gid == cst.st_gid &&
+	 st->st_mtime == cst.st_mtime ) {
+      if ( (in = fopen(cribpath, "rb")) ) {
+	int e = fread(&cfh, 1, sizeof cfh, in);
+	fclose(in);
+	/* Attempt to restore the atime */
+	ut.actime  = cst.st_atime;
+	ut.modtime = cst.st_mtime;
+	utime(cribpath, &ut);
+
+	if ( (e == sizeof cfh &&
+	      !memcmp(cfh.magic, zisofs_magic, sizeof zisofs_magic) &&
+	      (off_t)get_731(cfh.uncompressed_len) == st->st_size) ||
+	     (st->st_size == cst.st_size &&
+	      (e < (int)(sizeof zisofs_magic) ||
+	       memcmp(cfh.magic, zisofs_magic, sizeof zisofs_magic))) ) {
+	  /* File is cribbable.  Steal it. */
+	  if ( !link(cribpath, outpath) ) {
+	    message(vl_crib, "crib: %s -> %s\n", cribpath, outpath);
+	    ut.actime  = st->st_atime;
+	    ut.modtime = st->st_mtime;
+	    utime(outpath, &ut);	/* Set the the atime */
+	    
+	    return 0;
+	  }
+	}
+      }
+    }
+  }
+
+  in = fopen(inpath, "rb");
+  if ( !in )
+    return EX_NOINPUT;
+  out = fopen(outpath, "wb");
+  if ( !out ) {
+    fclose(in);
+    return EX_CANTCREAT;
+  }
+
+  if ( spawn_worker() ) {
+    err = opt.munger(in, out, st->st_size);
+    fclose(in);
+    fclose(out);
+    
+    chown(outpath, st->st_uid, st->st_gid);
+    chmod(outpath, st->st_mode);
+    ut.actime  = st->st_atime;
+    ut.modtime = st->st_mtime;
+    utime(outpath, &ut);
+    
+    end_worker(err);
+  } else {
+    fclose(in);
+    fclose(out);
+  }
+
+  return err;
+}
+
+int munge_tree(const char *intree, const char *outtree, const char *cribtree)
+{
+  char *in_path, *out_path, *crib_path;
+  char *in_file, *out_file, *crib_file;
+  DIR *thisdir;
+  struct dirent *dirent;
+  struct stat dirst;
+  int err = 0;
+  
+  /* Construct buffers with the common filename prefix, and point to the end */
+
+  in_path = xmalloc(strlen(intree) + NAME_MAX + 2);
+  strcpy(in_path, intree);
+  in_file = strchr(in_path, '\0');
+  *in_file++ = '/';
+
+  out_path = xmalloc(strlen(outtree) + NAME_MAX + 2);
+  strcpy(out_path, outtree);
+  out_file = strchr(out_path, '\0');
+  *out_file++ = '/';
+
+  if ( cribtree ) {
+    crib_path = xmalloc(strlen(cribtree) + NAME_MAX + 2);
+    strcpy(crib_path, cribtree);
+    crib_file = strchr(crib_path, '\0');
+    *crib_file++ = '/';
+  } else {
+    crib_path = crib_file = NULL;
+  }
+
+  /* Get directory information */
+  if ( stat(intree, &dirst) ) {
+    message(vl_error, "%s: Failed to stat directory %s: %s\n",
+	    program, intree, strerror(errno));
+    return EX_NOINPUT;
+  }
+
+  /* Open the directory */
+  thisdir = opendir(intree);
+  if ( !thisdir ) {
+    message(vl_error, "%s: Failed to open directory %s: %s\n",
+	    program, intree, strerror(errno));
+    return EX_NOINPUT;
+  }
+
+  /* Create output directory */
+  if ( mkdir(outtree, 0700) ) {
+    message(vl_error, "%s: Cannot create output directory %s: %s\n",
+	    program, outtree, strerror(errno));
+    return EX_CANTCREAT;
+  }
+
+  while ( (dirent = readdir(thisdir)) != NULL ) {
+    if ( !strcmp(dirent->d_name, ".") ||
+	 !strcmp(dirent->d_name, "..") )
+      continue;			/* Ignore . and .. */
+    
+    strcpy(in_file, dirent->d_name);
+    strcpy(out_file, dirent->d_name);
+    if ( crib_file )
+      strcpy(crib_file, dirent->d_name);
+    
+    err = munge_entry(in_path, out_path, crib_path, &dirst);
+    if ( err )
+      break;
+  }
+  closedir(thisdir);
+  
+  free(in_path);
+  free(out_path);
+  
+  return err;
+}
+
+
+int munge_entry(const char *in_path, const char *out_path,
+		const char *crib_path, const struct stat *dirst)
+{
+  struct stat st;
+  struct utimbuf ut;
+  int err = 0;
+
+  message(vl_filename, "%s -> %s\n", in_path, out_path);
+
+  if ( lstat(in_path, &st) ) {
+    message(vl_error, "%s: Failed to stat file %s: %s\n",
+	    program, in_path, strerror(errno));
+    return EX_NOINPUT;
+  }
+  
+  if ( S_ISREG(st.st_mode) ) {
+    if ( st.st_nlink > 1 ) {
+      /* Hard link. */
+      const char *linkname;
+      
+      if ( (linkname = hash_find_file(&st)) != NULL ) {
+	/* We've seen it before, hard link it */
+	
+	if ( link(linkname, out_path) ) {
+	  message(vl_error, "%s: hard link %s -> %s failed: %s\n",
+		  program, out_path, linkname, strerror(errno));
+	  return EX_CANTCREAT;
+	}
+      } else {
+	/* First encounter, compress and enter into hash */
+	if ( (err = munge_file(in_path, out_path, crib_path, &st)) != 0 ) {
+	  message(vl_error, "%s: %s: %s", program, in_path, strerror(errno));
+	  return err;
+	}
+	hash_insert_file(&st, out_path);
+      }
+    } else {
+      /* Singleton file; no funnies */
+      if ( (err = munge_file(in_path, out_path, crib_path, &st)) != 0 ) {
+	message(vl_error, "%s: %s: %s", program, in_path, strerror(errno));
+	return err;
+      }
+    }
+  } else if ( S_ISDIR(st.st_mode) ) {
+    /* Recursion: see recursion */
+    if ( !opt.onedir &&
+	 (!opt.onefs || (dirst && dirst->st_dev == st.st_dev)) ) {
+      if ( (err = munge_tree(in_path, out_path, crib_path)) != 0 )
+	return err;
+    } else if ( opt.do_mkdir ) {
+      /* Create stub directories */
+      if ( mkdir(out_path, st.st_mode) ) {
+	message(vl_error, "%s: %s: %s", program, out_path, strerror(errno));
+	return EX_CANTCREAT;
+      }
+    }
+  } else if ( S_ISLNK(st.st_mode) ) {
+    int chars;
+#ifdef PATH_MAX
+#define BUFFER_SLACK PATH_MAX
+#else
+#define BUFFER_SLACK BUFSIZ
+#endif
+    int buffer_len = st.st_size + BUFFER_SLACK + 1;
+    char *buffer = xmalloc(buffer_len);
+    if ( (chars = readlink(in_path, buffer, buffer_len)) < 0 ) {
+      message(vl_error, "%s: readlink failed for %s: %s\n",
+	      program, in_path, strerror(errno));
+      return EX_NOINPUT;
+    }
+    buffer[chars] = '\0';
+    if ( symlink(buffer, out_path) ) {
+      message(vl_error, "%s: symlink %s -> %s failed: %s\n",
+	      program, out_path, buffer, strerror(errno));
+      return EX_CANTCREAT;
+    }
+    free(buffer);
+  } else {
+    if ( st.st_nlink > 1 ) {
+      /* Hard link. */
+      const char *linkname;
+      
+      if ( (linkname = hash_find_file(&st)) != NULL ) {
+	/* We've seen it before, hard link it */
+	
+	if ( link(linkname, out_path) ) {
+	  message(vl_error, "%s: hard link %s -> %s failed: %s\n",
+		  program, out_path, linkname, strerror(errno));
+	  return EX_CANTCREAT;
+	}
+      } else {
+	/* First encounter, create and enter into hash */
+	if ( mknod(out_path, st.st_mode, st.st_rdev) ) {
+	  message(vl_error, "%s: mknod failed for %s: %s\n",
+		  program, out_path, strerror(errno));
+	  return EX_CANTCREAT;
+	}
+	hash_insert_file(&st, out_path);
+      }
+    } else {
+      /* Singleton node; no funnies */
+      if ( mknod(out_path, st.st_mode, st.st_rdev) ) {
+	message(vl_error, "%s: mknod failed for %s: %s\n",
+		program, out_path, strerror(errno));
+	return EX_CANTCREAT;
+      }
+    }
+  }
+  
+  /* This is done by munge_file() for files */
+  if ( !S_ISREG(st.st_mode) ) {
+#ifdef HAVE_LCHOWN
+    if ( lchown(out_path, st.st_uid, st.st_gid) && opt.sloppy && !err ) {
+      message(vl_error, "%s: %s: %s", program, out_path, strerror(errno));
+      err = EX_CANTCREAT;
+    }
+#endif
+    if ( !S_ISLNK(st.st_mode) ) {
+#ifndef HAVE_LCHOWN
+      if ( chown(out_path, st.st_uid, st.st_gid) && !opt.sloppy && !err ) {
+	message(vl_error, "%s: %s: %s", program, out_path, strerror(errno));
+	err = EX_CANTCREAT;
+      }
+#endif
+      if ( chmod(out_path, st.st_mode) && !opt.sloppy && !err ) {
+	message(vl_error, "%s: %s: %s", program, out_path, strerror(errno));
+	err = EX_CANTCREAT;
+      }
+      ut.actime  = st.st_atime;
+      ut.modtime = st.st_mtime;
+      if ( utime(out_path, &ut) && !opt.sloppy && !err ) {
+	message(vl_error, "%s: %s: %s", program, out_path, strerror(errno));
+	err = EX_CANTCREAT;
+      }
+    }
+  }
+
+  return err;
+}
+

--- zisofs_tools/workers.c	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/workers.c	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,98 @@
+#ident "$Id: workers.c,v 1.2 2001/07/31 03:20:52 hpa Exp $"
+/* ----------------------------------------------------------------------- *
+ *   
+ *   Copyright 2001 H. Peter Anvin - All Rights Reserved
+ *
+ *   This program is free software; you can redistribute it and/or modify
+ *   it under the terms of the GNU General Public License as published by
+ *   the Free Software Foundation, Inc., 675 Mass Ave, Cambridge MA 02139,
+ *   USA; either version 2 of the License, or (at your option) any later
+ *   version; incorporated herein by reference.
+ *
+ * ----------------------------------------------------------------------- */
+
+/*
+ * workers.c
+ *
+ * Parallel job maintenance
+ */
+
+#include <stddef.h>
+#include <stdlib.h>
+#include <unistd.h>
+#include <signal.h>
+#include <stdio.h>
+#include <sys/wait.h>
+#include "mkzftree.h"
+
+/* Global option */
+extern int parallel;		/* Number of parallel jobs */
+
+/* Functions related to parallel execution */
+static volatile int work_threads = 0;
+static int is_worker = 0;
+
+/* This waits for one worker to finish */
+static void wait_for_one_worker(void)
+{
+  int status;
+
+  if ( wait(&status) > 0 ) {
+    work_threads--;
+    
+    if ( WIFSIGNALED(status) ) {
+      kill(getpid(), WTERMSIG(status));
+      exit(EX_SOFTWARE);
+    } else if ( WEXITSTATUS(status) ) {
+      exit(WEXITSTATUS(status));
+    }
+  }
+}  
+
+/* This waits for *all* workers to finish */
+void wait_for_all_workers(void)
+{
+  while ( work_threads )
+    wait_for_one_worker();
+}
+
+/* This returns 1 if the "job" at hand should be performed */
+int spawn_worker(void)
+{
+  pid_t f;
+  
+  if ( opt.parallel == 0 )
+    return 1;
+
+  fflush(NULL);
+
+  /* Wait for a work slot */
+  while ( work_threads >= opt.parallel )
+    wait_for_one_worker();
+  
+  /* Spawn worker process */
+  work_threads++;		/* Avoids race conditions */
+  f = fork();
+  if ( f == -1 ) {
+    work_threads--;
+    return 1;			/* Do it ourselves */
+  }
+
+  if ( f == 0 ) {
+    /* Worker process */
+    is_worker = 1;
+    return 1;
+  } else {
+    /* Control process */
+    return 0;
+  }
+}
+
+/* Routine to perform at the end of the job */
+void end_worker(int err)
+{
+  if ( is_worker ) {
+    exit(err);
+  }
+}
+

--- zisofs_tools/zisofs.magic	1970-01-01 01:00:00.000000000 +0100
+++ zisofs_tools/zisofs.magic	2002-12-27 14:48:49.000000000 +0100
@@ -0,0 +1,8 @@
+
+#------------------------------------------------------------------------------
+# zisofs: file(1) magic for zisofs/RockRidge compressed files
+#
+# from H. Peter Anvin <hpa@zytor.com> May 4, 2001
+#
+0	string	\x37\xE4\x53\x96\xC9\xDB\xD6\x07	zisofs/Rockridge compressed file
+>8	lelong		x		- %d bytes
