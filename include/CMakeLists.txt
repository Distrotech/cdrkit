PROJECT (LIBSCHILY)
INCLUDE_DIRECTORIES(../include ../libhfs_iso . ../cdrecord)
#ADD_DEFINITIONS(-DVA_LIST_IS_ARRAY) # breaks on alpha

# auto-generated header with sizeof magic
INCLUDE(CheckTypeSize)
CHECK_TYPE_SIZE(short SIZE_SHORT)
MATH(EXPR SHORTLESS ${SIZE_SHORT}-1)
CHECK_TYPE_SIZE(int SIZE_INT)
MATH(EXPR INTLESS ${SIZE_INT}-1)
CHECK_TYPE_SIZE(long SIZE_LONG)
MATH(EXPR LONGLESS ${SIZE_LONG}-1)
CHECK_TYPE_SIZE("long long" SIZE_LLONG)
MATH(EXPR LLONGLESS ${SIZE_LLONG}-1)
CHECK_TYPE_SIZE(float SIZE_FLOAT)
MATH(EXPR FLOATLESS ${SIZE_FLOAT}-1)
CHECK_TYPE_SIZE(double SIZE_DOUBLE)
MATH(EXPR DOUBLELESS ${SIZE_DOUBLE}-1)
CHECK_TYPE_SIZE("char*" SIZE_PTR)
MATH(EXPR PTRLESS ${SIZE_PTR}-1)
CONFIGURE_FILE( ${CMAKE_CURRENT_SOURCE_DIR}/../include/align.h.in ${CMAKE_CURRENT_SOURCE_DIR}/../include/align.h)
SET_SOURCE_FILES_PROPERTIES(align.h PROPERTIES GENERATED 1)


TRY_COMPILE(VA_LIST_IS_ARRAY ${CMAKE_BINARY_DIR}  ${CMAKE_CURRENT_SOURCE_DIR}/../include/test_VA_LIST_IS_ARRAY.c)
# invert the result, has the condition IFF compiler fails
SET(VA_LIST_IS_ARRAY not VA_LIST_IS_ARRAY)

CONFIGURE_FILE( ${CMAKE_CURRENT_SOURCE_DIR}/../include/xconfig.h.in ${CMAKE_CURRENT_SOURCE_DIR}/../include/xconfig.h)
SET_SOURCE_FILES_PROPERTIES(xconfig.h PROPERTIES GENERATED 1)

